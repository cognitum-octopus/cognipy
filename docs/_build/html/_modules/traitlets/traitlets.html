

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>traitlets.traitlets &mdash; CogniPy 0.1.6 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> CogniPy
          

          
            
            <img src="../../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">CogniPy Documentation:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Project description</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../grammar.html">Grammar</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">API Refrence</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../dictonary.html">Dictonary</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">CogniPy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>traitlets.traitlets</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for traitlets.traitlets</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">A lightweight Traits like module.</span>

<span class="sd">This is designed to provide a lightweight, simple, pure Python version of</span>
<span class="sd">many of the capabilities of enthought.traits.  This includes:</span>

<span class="sd">* Validation</span>
<span class="sd">* Type specification with defaults</span>
<span class="sd">* Static and dynamic notification</span>
<span class="sd">* Basic predefined types</span>
<span class="sd">* An API that is similar to enthought.traits</span>

<span class="sd">We don&#39;t support:</span>

<span class="sd">* Delegation</span>
<span class="sd">* Automatic GUI generation</span>
<span class="sd">* A full set of trait types.  Most importantly, we don&#39;t provide container</span>
<span class="sd">  traits (list, dict, tuple) that can trigger notifications if their</span>
<span class="sd">  contents change.</span>
<span class="sd">* API compatibility with enthought.traits</span>

<span class="sd">There are also some important difference in our design:</span>

<span class="sd">* enthought.traits does not validate default values.  We do.</span>

<span class="sd">We choose to create this module because we need these capabilities, but</span>
<span class="sd">we need them to be pure Python so they work in all Python implementations,</span>
<span class="sd">including Jython and IronPython.</span>

<span class="sd">Inheritance diagram:</span>

<span class="sd">.. inheritance-diagram:: traitlets.traitlets</span>
<span class="sd">   :parts: 3</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># Copyright (c) IPython Development Team.</span>
<span class="c1"># Distributed under the terms of the Modified BSD License.</span>
<span class="c1">#</span>
<span class="c1"># Adapted from enthought.traits, Copyright (c) Enthought, Inc.,</span>
<span class="c1"># also under the terms of the Modified BSD License.</span>

<span class="kn">from</span> <span class="nn">ast</span> <span class="kn">import</span> <span class="n">literal_eval</span>
<span class="kn">import</span> <span class="nn">contextlib</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">types</span>
<span class="kn">import</span> <span class="nn">enum</span>
<span class="kn">from</span> <span class="nn">warnings</span> <span class="kn">import</span> <span class="n">warn</span><span class="p">,</span> <span class="n">warn_explicit</span>

<span class="kn">from</span> <span class="nn">.utils.getargspec</span> <span class="kn">import</span> <span class="n">getargspec</span>
<span class="kn">from</span> <span class="nn">.utils.importstring</span> <span class="kn">import</span> <span class="n">import_item</span>
<span class="kn">from</span> <span class="nn">.utils.sentinel</span> <span class="kn">import</span> <span class="n">Sentinel</span>
<span class="kn">from</span> <span class="nn">.utils.bunch</span> <span class="kn">import</span> <span class="n">Bunch</span>
<span class="kn">from</span> <span class="nn">.utils.descriptions</span> <span class="kn">import</span> <span class="n">describe</span><span class="p">,</span> <span class="n">class_of</span><span class="p">,</span> <span class="n">add_article</span><span class="p">,</span> <span class="n">repr_type</span>

<span class="n">SequenceTypes</span> <span class="o">=</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">set</span><span class="p">,</span> <span class="nb">frozenset</span><span class="p">)</span>

<span class="c1"># backward compatibility, use to differ between Python 2 and 3.</span>
<span class="n">ClassTypes</span> <span class="o">=</span> <span class="p">(</span><span class="nb">type</span><span class="p">,)</span>

<span class="c1"># exports:</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;default&quot;</span><span class="p">,</span>
    <span class="s2">&quot;validate&quot;</span><span class="p">,</span>
    <span class="s2">&quot;observe&quot;</span><span class="p">,</span>
    <span class="s2">&quot;observe_compat&quot;</span><span class="p">,</span>
    <span class="s2">&quot;link&quot;</span><span class="p">,</span>
    <span class="s2">&quot;directional_link&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dlink&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Undefined&quot;</span><span class="p">,</span>
    <span class="s2">&quot;All&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NoDefaultSpecified&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TraitError&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HasDescriptors&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HasTraits&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MetaHasDescriptors&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MetaHasTraits&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BaseDescriptor&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TraitType&quot;</span><span class="p">,</span>
    <span class="s2">&quot;parse_notifier_name&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="c1"># any TraitType subclass (that doesn&#39;t start with _) will be added automatically</span>

<span class="c1">#-----------------------------------------------------------------------------</span>
<span class="c1"># Basic classes</span>
<span class="c1">#-----------------------------------------------------------------------------</span>


<span class="n">Undefined</span> <span class="o">=</span> <span class="n">Sentinel</span><span class="p">(</span><span class="s1">&#39;Undefined&#39;</span><span class="p">,</span> <span class="s1">&#39;traitlets&#39;</span><span class="p">,</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Used in Traitlets to specify that no defaults are set in kwargs</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="p">)</span>

<span class="n">All</span> <span class="o">=</span> <span class="n">Sentinel</span><span class="p">(</span><span class="s1">&#39;All&#39;</span><span class="p">,</span> <span class="s1">&#39;traitlets&#39;</span><span class="p">,</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Used in Traitlets to listen to all types of notification or to notifications</span>
<span class="sd">from all trait attributes.</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="p">)</span>

<span class="c1"># Deprecated alias</span>
<span class="n">NoDefaultSpecified</span> <span class="o">=</span> <span class="n">Undefined</span>

<span class="k">class</span> <span class="nc">TraitError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="c1">#-----------------------------------------------------------------------------</span>
<span class="c1"># Utilities</span>
<span class="c1">#-----------------------------------------------------------------------------</span>

<span class="n">_name_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[a-zA-Z_][a-zA-Z0-9_]*$&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">isidentifier</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">isidentifier</span><span class="p">()</span>

<span class="n">_deprecations_shown</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">_should_warn</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Add our own checks for too many deprecation warnings.</span>

<span class="sd">    Limit to once per package.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">env_flag</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;TRAITLETS_ALL_DEPRECATIONS&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">env_flag</span> <span class="ow">and</span> <span class="n">env_flag</span> <span class="o">!=</span> <span class="s1">&#39;0&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_deprecations_shown</span><span class="p">:</span>
        <span class="n">_deprecations_shown</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

<span class="k">def</span> <span class="nf">_deprecated_method</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">method_name</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Show deprecation warning about a magic method definition.</span>

<span class="sd">    Uses warn_explicit to bind warning to method definition instead of triggering code,</span>
<span class="sd">    which isn&#39;t relevant.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">warn_msg</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{classname}</span><span class="s2">.</span><span class="si">{method_name}</span><span class="s2"> is deprecated in traitlets 4.1: </span><span class="si">{msg}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">classname</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">method_name</span><span class="o">=</span><span class="n">method_name</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="n">msg</span>
    <span class="p">)</span>

    <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmro</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">method_name</span> <span class="ow">in</span> <span class="n">parent</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">:</span>
            <span class="bp">cls</span> <span class="o">=</span> <span class="n">parent</span>
            <span class="k">break</span>
    <span class="c1"># limit deprecation messages to once per package</span>
    <span class="n">package_name</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__module__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">package_name</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">_should_warn</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
        <span class="k">return</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getsourcefile</span><span class="p">(</span><span class="n">method</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;&lt;unknown&gt;&quot;</span>
        <span class="n">lineno</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getsourcelines</span><span class="p">(</span><span class="n">method</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="mi">0</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># Failed to inspect for some reason</span>
        <span class="n">warn</span><span class="p">(</span><span class="n">warn_msg</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">(inspection failed) </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="p">),</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">warn_explicit</span><span class="p">(</span><span class="n">warn_msg</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">lineno</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_safe_literal_eval</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Safely evaluate an expression</span>

<span class="sd">    Returns original string if eval fails.</span>

<span class="sd">    Use only where types are ambiguous.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">literal_eval</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">NameError</span><span class="p">,</span> <span class="ne">SyntaxError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">s</span>

<span class="k">def</span> <span class="nf">is_trait</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns whether the given value is an instance or subclass of TraitType.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">TraitType</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">TraitType</span><span class="p">)))</span>


<span class="k">def</span> <span class="nf">parse_notifier_name</span><span class="p">(</span><span class="n">names</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert the name argument to a list of names.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; parse_notifier_name([])</span>
<span class="sd">    [All]</span>
<span class="sd">    &gt;&gt;&gt; parse_notifier_name(&quot;a&quot;)</span>
<span class="sd">    [&#39;a&#39;]</span>
<span class="sd">    &gt;&gt;&gt; parse_notifier_name([&quot;a&quot;, &quot;b&quot;])</span>
<span class="sd">    [&#39;a&#39;, &#39;b&#39;]</span>
<span class="sd">    &gt;&gt;&gt; parse_notifier_name(All)</span>
<span class="sd">    [All]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">names</span> <span class="ow">is</span> <span class="n">All</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">names</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">names</span> <span class="ow">or</span> <span class="n">All</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">All</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;names must be strings, not </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">n</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">names</span>


<span class="k">class</span> <span class="nc">_SimpleTest</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">def</span> <span class="fm">__call__</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">test</span>  <span class="p">):</span>
        <span class="k">return</span> <span class="n">test</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;SimpleTest(</span><span class="si">%r</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">getmembers</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="n">predicate</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A safe version of inspect.getmembers that handles missing attributes.</span>

<span class="sd">    This is useful when there are descriptor based attributes that for</span>
<span class="sd">    some reason raise AttributeError even though they exist.  This happens</span>
<span class="sd">    in zope.inteface with the __provides__ attribute.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">predicate</span> <span class="ow">or</span> <span class="n">predicate</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
    <span class="n">results</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">results</span>

<span class="k">def</span> <span class="nf">_validate_link</span><span class="p">(</span><span class="o">*</span><span class="n">tuples</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate arguments for traitlet link functions&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tuples</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Each linked traitlet must be specified as (HasTraits, &#39;trait_name&#39;), not </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">t</span><span class="p">)</span>
        <span class="n">obj</span><span class="p">,</span> <span class="n">trait_name</span> <span class="o">=</span> <span class="n">t</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">HasTraits</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Each object must be HasTraits, not </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">trait_name</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">traits</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%r</span><span class="s2"> has no trait </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">trait_name</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">link</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Link traits from different objects together so they remain in sync.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    source : (object / attribute name) pair</span>
<span class="sd">    target : (object / attribute name) pair</span>
<span class="sd">    transform: iterable with two callables (optional)</span>
<span class="sd">        Data transformation between source and target and target and source.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; c = link((src, &quot;value&quot;), (tgt, &quot;value&quot;))</span>
<span class="sd">    &gt;&gt;&gt; src.value = 5  # updates other objects as well</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">updating</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">_validate_link</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_transform</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transform_inv</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">transform</span> <span class="k">if</span> <span class="n">transform</span> <span class="k">else</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">,)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">link</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">link</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_transform</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>

        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_update_target</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_update_source</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
    <span class="k">def</span> <span class="nf">_busy_updating</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updating</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">yield</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updating</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_update_target</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">updating</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_busy_updating</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transform</span><span class="p">(</span><span class="n">change</span><span class="o">.</span><span class="n">new</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">!=</span> <span class="n">change</span><span class="o">.</span><span class="n">new</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">TraitError</span><span class="p">(</span>
                    <span class="s2">&quot;Broken link </span><span class="si">{}</span><span class="s2">: the source value changed while updating &quot;</span>
                    <span class="s2">&quot;the target.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_update_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">updating</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_busy_updating</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_transform_inv</span><span class="p">(</span><span class="n">change</span><span class="o">.</span><span class="n">new</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">!=</span> <span class="n">change</span><span class="o">.</span><span class="n">new</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">TraitError</span><span class="p">(</span>
                    <span class="s2">&quot;Broken link </span><span class="si">{}</span><span class="s2">: the target value changed while updating &quot;</span>
                    <span class="s2">&quot;the source.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">unlink</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">unobserve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_update_target</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">unobserve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_update_source</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>


<span class="k">class</span> <span class="nc">directional_link</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Link the trait of a source object with traits of target objects.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    source : (object, attribute name) pair</span>
<span class="sd">    target : (object, attribute name) pair</span>
<span class="sd">    transform: callable (optional)</span>
<span class="sd">        Data transformation between source and target.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; c = directional_link((src, &quot;value&quot;), (tgt, &quot;value&quot;))</span>
<span class="sd">    &gt;&gt;&gt; src.value = 5  # updates target objects</span>
<span class="sd">    &gt;&gt;&gt; tgt.value = 6  # does not update source object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">updating</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_transform</span> <span class="o">=</span> <span class="n">transform</span> <span class="k">if</span> <span class="n">transform</span> <span class="k">else</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span>
        <span class="n">_validate_link</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">link</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">link</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_transform</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
    <span class="k">def</span> <span class="nf">_busy_updating</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updating</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">yield</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updating</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">updating</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_busy_updating</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_transform</span><span class="p">(</span><span class="n">change</span><span class="o">.</span><span class="n">new</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">unlink</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">unobserve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="n">dlink</span> <span class="o">=</span> <span class="n">directional_link</span>


<span class="c1">#-----------------------------------------------------------------------------</span>
<span class="c1"># Base Descriptor Class</span>
<span class="c1">#-----------------------------------------------------------------------------</span>


<span class="k">class</span> <span class="nc">BaseDescriptor</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base descriptor class</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This implements Python&#39;s descriptor protocol.</span>

<span class="sd">    This class is the base class for all such descriptors.  The</span>
<span class="sd">    only magic we use is a custom metaclass for the main :class:`HasTraits`</span>
<span class="sd">    class that does the following:</span>

<span class="sd">    1. Sets the :attr:`name` attribute of every :class:`BaseDescriptor`</span>
<span class="sd">       instance in the class dict to the name of the attribute.</span>
<span class="sd">    2. Sets the :attr:`this_class` attribute of every :class:`BaseDescriptor`</span>
<span class="sd">       instance in the class dict to the *class* that declared the trait.</span>
<span class="sd">       This is used by the :class:`This` trait to allow subclasses to</span>
<span class="sd">       accept superclasses for :class:`This` values.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">this_class</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">class_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Part of the initialization which may depend on the underlying</span>
<span class="sd">        HasDescriptors class.</span>

<span class="sd">        It is typically overloaded for specific types.</span>

<span class="sd">        This method is called by :meth:`MetaHasDescriptors.__init__`</span>
<span class="sd">        passing the class (`cls`) and `name` under which the descriptor</span>
<span class="sd">        has been assigned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">this_class</span> <span class="o">=</span> <span class="bp">cls</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

    <span class="k">def</span> <span class="nf">subclass_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">cls</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">instance_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Part of the initialization which may depend on the underlying</span>
<span class="sd">        HasDescriptors instance.</span>

<span class="sd">        It is typically overloaded for specific types.</span>

<span class="sd">        This method is called by :meth:`HasTraits.__new__` and in the</span>
<span class="sd">        :meth:`BaseDescriptor.instance_init` method of descriptors holding</span>
<span class="sd">        other descriptors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>


<span class="k">class</span> <span class="nc">TraitType</span><span class="p">(</span><span class="n">BaseDescriptor</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A base class for all trait types.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">metadata</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">allow_none</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">read_only</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">info_text</span> <span class="o">=</span> <span class="s1">&#39;any value&#39;</span>
    <span class="n">default_value</span> <span class="o">=</span> <span class="n">Undefined</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Declare a traitlet.</span>

<span class="sd">        If *allow_none* is True, None is a valid value in addition to any</span>
<span class="sd">        values that are normally valid. The default is up to the subclass.</span>
<span class="sd">        For most trait types, the default value for ``allow_none`` is False.</span>

<span class="sd">        Extra metadata can be associated with the traitlet using the .tag() convenience method</span>
<span class="sd">        or by using the traitlet instance&#39;s .metadata dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">default_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Undefined</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="n">default_value</span>
        <span class="k">if</span> <span class="n">allow_none</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">allow_none</span> <span class="o">=</span> <span class="n">allow_none</span>
        <span class="k">if</span> <span class="n">read_only</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_only</span> <span class="o">=</span> <span class="n">read_only</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="n">help</span> <span class="k">if</span> <span class="n">help</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">stacklevel</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()</span>
            <span class="c1"># count supers to determine stacklevel for warning</span>
            <span class="k">while</span> <span class="n">f</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span> <span class="o">==</span> <span class="s1">&#39;__init__&#39;</span><span class="p">:</span>
                <span class="n">stacklevel</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">f_back</span>
            <span class="n">mod</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">f_globals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;__name__&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
            <span class="n">pkg</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">key</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="s1">&#39;metadata-tag&#39;</span><span class="p">,</span> <span class="n">pkg</span><span class="p">]</span> <span class="o">+</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">kwargs</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">_should_warn</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
                <span class="n">warn</span><span class="p">(</span><span class="s2">&quot;metadata </span><span class="si">%s</span><span class="s2"> was set from the constructor. &quot;</span>
                     <span class="s2">&quot;With traitlets 4.1, metadata should be set using the .tag() method, &quot;</span>
                     <span class="s2">&quot;e.g., Int().tag(key1=&#39;value1&#39;, key2=&#39;value2&#39;)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">kwargs</span><span class="p">,),</span>
                     <span class="ne">DeprecationWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="n">stacklevel</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span>

        <span class="c1"># We add help to the metadata during a deprecation period so that</span>
        <span class="c1"># code that looks for the help string there can find it.</span>
        <span class="k">if</span> <span class="n">help</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;help&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">help</span>

    <span class="k">def</span> <span class="nf">from_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get a value from a config string</span>

<span class="sd">        such as an environment variable or CLI arguments.</span>

<span class="sd">        Traits can override this method to define their own</span>
<span class="sd">        parsing of config strings.</span>

<span class="sd">        .. seealso:: item_from_string</span>

<span class="sd">        .. versionadded:: 5.0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_none</span> <span class="ow">and</span> <span class="n">s</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">s</span>

    <span class="k">def</span> <span class="nf">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The default generator for this trait</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This method is registered to HasTraits classes during ``class_init``</span>
<span class="sd">        in the same way that dynamic defaults defined by ``@default`` are.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Undefined</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_value</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;make_dynamic_default&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_dynamic_default</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Undefined will raise in TraitType.get</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_value</span>

    <span class="k">def</span> <span class="nf">get_default_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;DEPRECATED: Retrieve the static default value for this trait.</span>
<span class="sd">        Use self.default_value instead</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">warn</span><span class="p">(</span><span class="s2">&quot;get_default_value is deprecated in traitlets 4.0: use the .default_value attribute&quot;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">,</span>
             <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_value</span>

    <span class="k">def</span> <span class="nf">init_default_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;DEPRECATED: Set the static default value for the trait type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">warn</span><span class="p">(</span><span class="s2">&quot;init_default_value is deprecated in traitlets 4.0, and may be removed in the future&quot;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">,</span>
             <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_value</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_trait_values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">_trait_values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="c1"># Check for a dynamic initializer.</span>
            <span class="n">default</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">trait_defaults</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="n">Undefined</span><span class="p">:</span>
                <span class="n">warn</span><span class="p">(</span>
                    <span class="s2">&quot;Explicit using of Undefined as the default value &quot;</span>
                    <span class="s2">&quot;is deprecated in traitlets 5.0, and may cause &quot;</span>
                    <span class="s2">&quot;exceptions in the future.&quot;</span><span class="p">,</span>
                    <span class="ne">DeprecationWarning</span><span class="p">,</span>
                    <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span>
                <span class="p">)</span>
            <span class="k">with</span> <span class="n">obj</span><span class="o">.</span><span class="n">cross_validation_lock</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_trait_values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_notify_observers</span><span class="p">(</span><span class="n">Bunch</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span>
                <span class="n">owner</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span>
                <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">,</span>
            <span class="p">))</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="c1"># This should never be reached.</span>
            <span class="k">raise</span> <span class="n">TraitError</span><span class="p">(</span><span class="s1">&#39;Unexpected error in TraitType: &#39;</span>
                             <span class="s1">&#39;default value not set properly&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span> <span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the value of the trait by self.name for the instance.</span>

<span class="sd">        Default values are instantiated when :meth:`HasTraits.__new__`</span>
<span class="sd">        is called.  Thus by the time this method gets called either the</span>
<span class="sd">        default value or a user defined value (they called :meth:`__set__`)</span>
<span class="sd">        is in the :class:`HasTraits` instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">new_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">old_value</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">_trait_values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">old_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_value</span>

        <span class="n">obj</span><span class="o">.</span><span class="n">_trait_values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_value</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">silent</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">old_value</span> <span class="o">==</span> <span class="n">new_value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="c1"># if there is an error in comparing, default to notify</span>
            <span class="n">silent</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">silent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># we explicitly compare silent to True just in case the equality</span>
            <span class="c1"># comparison above returns something other than True/False</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_notify_trait</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">old_value</span><span class="p">,</span> <span class="n">new_value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the value of the trait by self.name for the instance.</span>

<span class="sd">        Values pass through a validation stage where errors are raised when</span>
<span class="sd">        impropper types, or types that cannot be coerced, are encountered.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_only</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">TraitError</span><span class="p">(</span><span class="s1">&#39;The &quot;</span><span class="si">%s</span><span class="s1">&quot; trait is read-only.&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_none</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;validate&#39;</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">_cross_validation_lock</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cross_validate</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">_cross_validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">_trait_validators</span><span class="p">:</span>
            <span class="n">proposal</span> <span class="o">=</span> <span class="n">Bunch</span><span class="p">({</span><span class="s1">&#39;trait&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">,</span> <span class="s1">&#39;owner&#39;</span><span class="p">:</span> <span class="n">obj</span><span class="p">})</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">_trait_validators</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">](</span><span class="n">obj</span><span class="p">,</span> <span class="n">proposal</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;_</span><span class="si">%s</span><span class="s1">_validate&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
            <span class="n">meth_name</span> <span class="o">=</span> <span class="s1">&#39;_</span><span class="si">%s</span><span class="s1">_validate&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
            <span class="n">cross_validate</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">meth_name</span><span class="p">)</span>
            <span class="n">_deprecated_method</span><span class="p">(</span><span class="n">cross_validate</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">meth_name</span><span class="p">,</span>
                <span class="s2">&quot;use @validate decorator instead.&quot;</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span> <span class="fm">__or__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Union</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">Union</span><span class="p">([</span><span class="bp">self</span><span class="p">]</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">trait_types</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Union</span><span class="p">([</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">info_text</span>

    <span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Raise a TraitError</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : HasTraits or None</span>
<span class="sd">            The instance which owns the trait. If not</span>
<span class="sd">            object is given, then an object agnostic</span>
<span class="sd">            error will be raised.</span>
<span class="sd">        value : any</span>
<span class="sd">            The value that caused the error.</span>
<span class="sd">        error : Exception (default: None)</span>
<span class="sd">            An error that was raised by a child trait.</span>
<span class="sd">            The arguments of this exception should be</span>
<span class="sd">            of the form ``(value, info, *traits)``.</span>
<span class="sd">            Where the ``value`` and ``info`` are the</span>
<span class="sd">            problem value, and string describing the</span>
<span class="sd">            expected value. The ``traits`` are a series</span>
<span class="sd">            of :class:`TraitType` instances that are</span>
<span class="sd">            &quot;children&quot; of this one (the first being</span>
<span class="sd">            the deepest).</span>
<span class="sd">        info : str (default: None)</span>
<span class="sd">            A description of the expected value. By</span>
<span class="sd">            default this is infered from this trait&#39;s</span>
<span class="sd">            ``info`` method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># handle nested error</span>
            <span class="n">error</span><span class="o">.</span><span class="n">args</span> <span class="o">+=</span> <span class="p">(</span><span class="bp">self</span><span class="p">,)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># this is the root trait that must format the final message</span>
                <span class="n">chain</span> <span class="o">=</span> <span class="s2">&quot; of &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">describe</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">error</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>
                <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">error</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;The &#39;</span><span class="si">%s</span><span class="s2">&#39; trait of </span><span class="si">%s</span><span class="s2"> instance contains </span><span class="si">%s</span><span class="s2"> which &quot;</span>
                        <span class="s2">&quot;expected </span><span class="si">%s</span><span class="s2">, not </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">describe</span><span class="p">(</span><span class="s2">&quot;an&quot;</span><span class="p">,</span> <span class="n">obj</span><span class="p">),</span>
                        <span class="n">chain</span><span class="p">,</span> <span class="n">error</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">describe</span><span class="p">(</span><span class="s2">&quot;the&quot;</span><span class="p">,</span> <span class="n">error</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])),)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">error</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;The &#39;</span><span class="si">%s</span><span class="s2">&#39; trait contains </span><span class="si">%s</span><span class="s2"> which &quot;</span>
                        <span class="s2">&quot;expected </span><span class="si">%s</span><span class="s2">, not </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">chain</span><span class="p">,</span>
                        <span class="n">error</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">describe</span><span class="p">(</span><span class="s2">&quot;the&quot;</span><span class="p">,</span> <span class="n">error</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])),)</span>
            <span class="k">raise</span> <span class="n">error</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># this trait caused an error</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># this is not the root trait</span>
                <span class="k">raise</span> <span class="n">TraitError</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">info</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(),</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># this is the root trait</span>
                <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">e</span> <span class="o">=</span> <span class="s2">&quot;The &#39;</span><span class="si">%s</span><span class="s2">&#39; trait of </span><span class="si">%s</span><span class="s2"> instance expected </span><span class="si">%s</span><span class="s2">, not </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">class_of</span><span class="p">(</span><span class="n">obj</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(),</span> <span class="n">describe</span><span class="p">(</span><span class="s2">&quot;the&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">e</span> <span class="o">=</span> <span class="s2">&quot;The &#39;</span><span class="si">%s</span><span class="s2">&#39; trait expected </span><span class="si">%s</span><span class="s2">, not </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(),</span> <span class="n">describe</span><span class="p">(</span><span class="s2">&quot;the&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
                <span class="k">raise</span> <span class="n">TraitError</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;DEPRECATED: Get a metadata value.</span>

<span class="sd">        Use .metadata[key] or .metadata.get(key, default) instead.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;help&#39;</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;use the instance .help string directly, like x.help&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;use the instance .metadata dictionary directly, like x.metadata[key] or x.metadata.get(key, default)&quot;</span>
        <span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Deprecated in traitlets 4.1, &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;DEPRECATED: Set a metadata key/value.</span>

<span class="sd">        Use .metadata[key] = value instead.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;help&#39;</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;use the instance .help string directly, like x.help = value&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;use the instance .metadata dictionary directly, like x.metadata[key] = value&quot;</span>
        <span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Deprecated in traitlets 4.1, &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">tag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">metadata</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets metadata and returns self.</span>

<span class="sd">        This allows convenient metadata tagging when initializing the trait, such as:</span>

<span class="sd">        &gt;&gt;&gt; Int(0).tag(config=True, sync=True)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">maybe_constructor_keywords</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">.</span><span class="n">intersection</span><span class="p">({</span><span class="s1">&#39;help&#39;</span><span class="p">,</span><span class="s1">&#39;allow_none&#39;</span><span class="p">,</span> <span class="s1">&#39;read_only&#39;</span><span class="p">,</span> <span class="s1">&#39;default_value&#39;</span><span class="p">})</span>
        <span class="k">if</span> <span class="n">maybe_constructor_keywords</span><span class="p">:</span>
            <span class="n">warn</span><span class="p">(</span><span class="s1">&#39;The following attributes are set in using `tag`, but seem to be constructor keywords arguments: </span><span class="si">%s</span><span class="s1"> &#39;</span><span class="o">%</span>
                    <span class="n">maybe_constructor_keywords</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">default_value_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default_value</span><span class="p">)</span>

<span class="c1">#-----------------------------------------------------------------------------</span>
<span class="c1"># The HasTraits implementation</span>
<span class="c1">#-----------------------------------------------------------------------------</span>

<span class="k">class</span> <span class="nc">_CallbackWrapper</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An object adapting a on_trait_change callback into an observe callback.</span>

<span class="sd">    The comparison operator __eq__ is implemented to enable removal of wrapped</span>
<span class="sd">    callbacks.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cb</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span> <span class="o">=</span> <span class="n">cb</span>
        <span class="c1"># Bound methods have an additional &#39;self&#39; argument.</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">MethodType</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nargs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">getargspec</span><span class="p">(</span><span class="n">cb</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="n">offset</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nargs</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">TraitError</span><span class="p">(</span><span class="s1">&#39;a trait changed callback must have 0-4 arguments.&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="c1"># The wrapper is equal to the wrapped element</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">_CallbackWrapper</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">cb</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span> <span class="o">==</span> <span class="n">other</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
        <span class="c1"># The wrapper is callable</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nargs</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">nargs</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="p">(</span><span class="n">change</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">nargs</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="p">(</span><span class="n">change</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">change</span><span class="o">.</span><span class="n">new</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">nargs</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="p">(</span><span class="n">change</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">change</span><span class="o">.</span><span class="n">old</span><span class="p">,</span> <span class="n">change</span><span class="o">.</span><span class="n">new</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">nargs</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="p">(</span><span class="n">change</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">change</span><span class="o">.</span><span class="n">old</span><span class="p">,</span> <span class="n">change</span><span class="o">.</span><span class="n">new</span><span class="p">,</span> <span class="n">change</span><span class="o">.</span><span class="n">owner</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_callback_wrapper</span><span class="p">(</span><span class="n">cb</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cb</span><span class="p">,</span> <span class="n">_CallbackWrapper</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cb</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_CallbackWrapper</span><span class="p">(</span><span class="n">cb</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">MetaHasDescriptors</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A metaclass for HasDescriptors.</span>

<span class="sd">    This metaclass makes sure that any TraitType class attributes are</span>
<span class="sd">    instantiated and sets their name attribute.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="n">mcls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">classdict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create the HasDescriptors class.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">classdict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># ----------------------------------------------------------------</span>
            <span class="c1"># Support of deprecated behavior allowing for TraitType types</span>
            <span class="c1"># to be used instead of TraitType instances.</span>
            <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">TraitType</span><span class="p">):</span>
                <span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Traits should be given as instances, not types (for example, `Int()`, not `Int`).&quot;</span>
                     <span class="s2">&quot; Passing types is deprecated in traitlets 4.1.&quot;</span><span class="p">,</span>
                     <span class="ne">DeprecationWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">classdict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">()</span>
            <span class="c1"># ----------------------------------------------------------------</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">MetaHasDescriptors</span><span class="p">,</span> <span class="n">mcls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">mcls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">classdict</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">classdict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Finish initializing the HasDescriptors class.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MetaHasDescriptors</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">classdict</span><span class="p">)</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">setup_class</span><span class="p">(</span><span class="n">classdict</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setup_class</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">classdict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Setup descriptor instance on the class</span>

<span class="sd">        This sets the :attr:`this_class` and :attr:`name` attributes of each</span>
<span class="sd">        BaseDescriptor in the class dict of the newly created ``cls`` before</span>
<span class="sd">        calling their :attr:`class_init` method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">classdict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">BaseDescriptor</span><span class="p">):</span>
                <span class="n">v</span><span class="o">.</span><span class="n">class_init</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">getmembers</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">BaseDescriptor</span><span class="p">):</span>
                <span class="n">v</span><span class="o">.</span><span class="n">subclass_init</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">MetaHasTraits</span><span class="p">(</span><span class="n">MetaHasDescriptors</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A metaclass for HasTraits.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">setup_class</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">classdict</span><span class="p">):</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_trait_default_generators</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MetaHasTraits</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">setup_class</span><span class="p">(</span><span class="n">classdict</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">observe</span><span class="p">(</span><span class="o">*</span><span class="n">names</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A decorator which can be used to observe Traits on a class.</span>

<span class="sd">    The handler passed to the decorator will be called with one ``change``</span>
<span class="sd">    dict argument. The change dictionary at least holds a &#39;type&#39; key and a</span>
<span class="sd">    &#39;name&#39; key, corresponding respectively to the type of notification and the</span>
<span class="sd">    name of the attribute that triggered the notification.</span>

<span class="sd">    Other keys may be passed depending on the value of &#39;type&#39;. In the case</span>
<span class="sd">    where type is &#39;change&#39;, we also have the following keys:</span>
<span class="sd">    * ``owner`` : the HasTraits instance</span>
<span class="sd">    * ``old`` : the old value of the modified trait attribute</span>
<span class="sd">    * ``new`` : the new value of the modified trait attribute</span>
<span class="sd">    * ``name`` : the name of the modified trait attribute.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    *names</span>
<span class="sd">        The str names of the Traits to observe on the object.</span>
<span class="sd">    type : str, kwarg-only</span>
<span class="sd">        The type of event to observe (e.g. &#39;change&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">names</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Please specify at least one trait name to observe.&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">All</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;trait names to observe must be strings or All, not </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ObserveHandler</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;change&#39;</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">observe_compat</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Backward-compatibility shim decorator for observers</span>

<span class="sd">    Use with:</span>

<span class="sd">    @observe(&#39;name&#39;)</span>
<span class="sd">    @observe_compat</span>
<span class="sd">    def _foo_changed(self, change):</span>
<span class="sd">        ...</span>

<span class="sd">    With this, `super()._foo_changed(self, name, old, new)` in subclasses will still work.</span>
<span class="sd">    Allows adoption of new observer API without breaking subclasses that override and super.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">compatible_observer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change_or_name</span><span class="p">,</span> <span class="n">old</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span> <span class="n">new</span><span class="o">=</span><span class="n">Undefined</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">change_or_name</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">change</span> <span class="o">=</span> <span class="n">change_or_name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">clsname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="n">warn</span><span class="p">(</span><span class="s2">&quot;A parent of </span><span class="si">%s</span><span class="s2">._</span><span class="si">%s</span><span class="s2">_changed has adopted the new (traitlets 4.1) @observe(change) API&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">clsname</span><span class="p">,</span> <span class="n">change_or_name</span><span class="p">),</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
            <span class="n">change</span> <span class="o">=</span> <span class="n">Bunch</span><span class="p">(</span>
                <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;change&#39;</span><span class="p">,</span>
                <span class="n">old</span><span class="o">=</span><span class="n">old</span><span class="p">,</span>
                <span class="n">new</span><span class="o">=</span><span class="n">new</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="n">change_or_name</span><span class="p">,</span>
                <span class="n">owner</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">compatible_observer</span>


<span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="o">*</span><span class="n">names</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A decorator to register cross validator of HasTraits object&#39;s state</span>
<span class="sd">    when a Trait is set.</span>

<span class="sd">    The handler passed to the decorator must have one ``proposal`` dict argument.</span>
<span class="sd">    The proposal dictionary must hold the following keys:</span>

<span class="sd">    * ``owner`` : the HasTraits instance</span>
<span class="sd">    * ``value`` : the proposed value for the modified trait attribute</span>
<span class="sd">    * ``trait`` : the TraitType instance associated with the attribute</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    names</span>
<span class="sd">        The str names of the Traits to validate.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Since the owner has access to the ``HasTraits`` instance via the &#39;owner&#39; key,</span>
<span class="sd">    the registered cross validator could potentially make changes to attributes</span>
<span class="sd">    of the ``HasTraits`` instance. However, we recommend not to do so. The reason</span>
<span class="sd">    is that the cross-validation of attributes may run in arbitrary order when</span>
<span class="sd">    exiting the ``hold_trait_notifications`` context, and such changes may not</span>
<span class="sd">    commute.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">names</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Please specify at least one trait name to validate.&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">All</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;trait names to validate must be strings or All, not </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ValidateHandler</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">default</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A decorator which assigns a dynamic default for a Trait on a HasTraits object.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name</span>
<span class="sd">        The str name of the Trait on the object whose default should be generated.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Unlike observers and validators which are properties of the HasTraits</span>
<span class="sd">    instance, default value generators are class-level properties.</span>

<span class="sd">    Besides, default generators are only invoked if they are registered in</span>
<span class="sd">    subclasses of `this_type`.</span>

<span class="sd">    ::</span>

<span class="sd">        class A(HasTraits):</span>
<span class="sd">            bar = Int()</span>

<span class="sd">            @default(&#39;bar&#39;)</span>
<span class="sd">            def get_bar_default(self):</span>
<span class="sd">                return 11</span>

<span class="sd">        class B(A):</span>
<span class="sd">            bar = Float()  # This trait ignores the default generator defined in</span>
<span class="sd">                           # the base class A</span>

<span class="sd">        class C(B):</span>

<span class="sd">            @default(&#39;bar&#39;)</span>
<span class="sd">            def some_other_default(self):  # This default generator should not be</span>
<span class="sd">                return 3.0                 # ignored since it is defined in a</span>
<span class="sd">                                           # class derived from B.a.this_class.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Trait name must be a string or All, not </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">DefaultHandler</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">EventHandler</span><span class="p">(</span><span class="n">BaseDescriptor</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">_init_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="n">func</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Pass `*args` and `**kwargs` to the handler&#39;s function if it exists.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;func&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_call</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inst</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">inst</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">return</span> <span class="n">types</span><span class="o">.</span><span class="n">MethodType</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="n">inst</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ObserveHandler</span><span class="p">(</span><span class="n">EventHandler</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trait_names</span> <span class="o">=</span> <span class="n">names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">type</span>

    <span class="k">def</span> <span class="nf">instance_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inst</span><span class="p">):</span>
        <span class="n">inst</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">trait_names</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ValidateHandler</span><span class="p">(</span><span class="n">EventHandler</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trait_names</span> <span class="o">=</span> <span class="n">names</span>

    <span class="k">def</span> <span class="nf">instance_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inst</span><span class="p">):</span>
        <span class="n">inst</span><span class="o">.</span><span class="n">_register_validator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">trait_names</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">DefaultHandler</span><span class="p">(</span><span class="n">EventHandler</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trait_name</span> <span class="o">=</span> <span class="n">name</span>

    <span class="k">def</span> <span class="nf">class_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">class_init</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_trait_default_generators</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">trait_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>


<span class="k">class</span> <span class="nc">HasDescriptors</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">MetaHasDescriptors</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The base class for all classes that have descriptors.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># Pass cls as args[0] to allow &quot;cls&quot; as keyword argument</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="c1"># This is needed because object.__new__ only accepts</span>
        <span class="c1"># the cls argument.</span>
        <span class="n">new_meth</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">HasDescriptors</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span>
        <span class="k">if</span> <span class="n">new_meth</span> <span class="ow">is</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__new__</span><span class="p">:</span>
            <span class="n">inst</span> <span class="o">=</span> <span class="n">new_meth</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">inst</span> <span class="o">=</span> <span class="n">new_meth</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">inst</span><span class="o">.</span><span class="n">setup_instance</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">inst</span>

    <span class="k">def</span> <span class="nf">setup_instance</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is called **before** self.__init__ is called.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Pass self as args[0] to allow &quot;self&quot; as keyword argument</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_cross_validation_lock</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
            <span class="c1"># Some descriptors raise AttributeError like zope.interface&#39;s</span>
            <span class="c1"># __provides__ attributes even though they exist.  This causes</span>
            <span class="c1"># AttributeErrors even though they are listed in dir(cls).</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">BaseDescriptor</span><span class="p">):</span>
                    <span class="n">value</span><span class="o">.</span><span class="n">instance_init</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">HasTraits</span><span class="p">(</span><span class="n">HasDescriptors</span><span class="p">,</span> <span class="n">metaclass</span><span class="o">=</span><span class="n">MetaHasTraits</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">setup_instance</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># Pass self as args[0] to allow &quot;self&quot; as keyword argument</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_trait_values</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_trait_notifiers</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_trait_validators</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">HasTraits</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">setup_instance</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># Allow trait values to be set using keyword arguments.</span>
        <span class="c1"># We need to use setattr for this to trigger validation and</span>
        <span class="c1"># notifications.</span>
        <span class="n">super_args</span> <span class="o">=</span> <span class="n">args</span>
        <span class="n">super_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">hold_trait_notifications</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_trait</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># passthrough args that don&#39;t set traits to super</span>
                    <span class="n">super_kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">HasTraits</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">super_args</span><span class="p">,</span> <span class="o">**</span><span class="n">super_kwargs</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">arg_s_list</span> <span class="o">=</span> <span class="p">[</span> <span class="nb">repr</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">super_args</span> <span class="p">]</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">super_kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">arg_s_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">=</span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
            <span class="n">arg_s</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">arg_s_list</span><span class="p">)</span>
            <span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;Passing unrecognized arguments to super(</span><span class="si">{classname}</span><span class="s2">).__init__(</span><span class="si">{arg_s}</span><span class="s2">).</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;</span><span class="si">{error}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;This is deprecated in traitlets 4.2.&quot;</span>
                <span class="s2">&quot;This error will be raised in a future release of traitlets.&quot;</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">arg_s</span><span class="o">=</span><span class="n">arg_s</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                    <span class="n">error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="ne">DeprecationWarning</span><span class="p">,</span>
                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1"># event handlers stored on an instance are</span>
        <span class="c1"># expected to be reinstantiated during a</span>
        <span class="c1"># recall of instance_init during __setstate__</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;_trait_notifiers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;_trait_validators&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;_trait_values&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trait_values</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;_cross_validation_lock&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># FIXME: raise if cloning locked!</span>

        <span class="k">return</span> <span class="n">d</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># event handlers are reassigned to self</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
            <span class="c1"># Some descriptors raise AttributeError like zope.interface&#39;s</span>
            <span class="c1"># __provides__ attributes even though they exist.  This causes</span>
            <span class="c1"># AttributeErrors even though they are listed in dir(cls).</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">EventHandler</span><span class="p">):</span>
                    <span class="n">value</span><span class="o">.</span><span class="n">instance_init</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
    <span class="k">def</span> <span class="nf">cross_validation_lock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A contextmanager for running a block with our cross validation lock set</span>
<span class="sd">        to True.</span>

<span class="sd">        At the end of the block, the lock&#39;s value is restored to its value</span>
<span class="sd">        prior to entering the block.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cross_validation_lock</span><span class="p">:</span>
            <span class="k">yield</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_cross_validation_lock</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">yield</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_cross_validation_lock</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
    <span class="k">def</span> <span class="nf">hold_trait_notifications</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Context manager for bundling trait change notifications and cross</span>
<span class="sd">        validation.</span>

<span class="sd">        Use this when doing multiple trait assignments (init, config), to avoid</span>
<span class="sd">        race conditions in trait notifiers requesting other trait values.</span>
<span class="sd">        All trait notifications will fire after all values have been assigned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cross_validation_lock</span><span class="p">:</span>
            <span class="k">yield</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cache</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">notify_change</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">notify_change</span>

            <span class="k">def</span> <span class="nf">compress</span><span class="p">(</span><span class="n">past_changes</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
                <span class="sd">&quot;&quot;&quot;Merges the provided change with the last if possible.&quot;&quot;&quot;</span>
                <span class="k">if</span> <span class="n">past_changes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">return</span> <span class="p">[</span><span class="n">change</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">past_changes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;change&#39;</span> <span class="ow">and</span> <span class="n">change</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;change&#39;</span><span class="p">:</span>
                        <span class="n">past_changes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;new&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">change</span><span class="o">.</span><span class="n">new</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># In case of changes other than &#39;change&#39;, append the notification.</span>
                        <span class="n">past_changes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">change</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">past_changes</span>

            <span class="k">def</span> <span class="nf">hold</span><span class="p">(</span><span class="n">change</span><span class="p">):</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">change</span><span class="o">.</span><span class="n">name</span>
                <span class="n">cache</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">compress</span><span class="p">(</span><span class="n">cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">change</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Replace notify_change with `hold`, caching and compressing</span>
                <span class="c1"># notifications, disable cross validation and yield.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">notify_change</span> <span class="o">=</span> <span class="n">hold</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_cross_validation_lock</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">yield</span>
                <span class="c1"># Cross validate final values when context is released.</span>
                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">cache</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="n">trait</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">trait</span><span class="o">.</span><span class="n">_cross_validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">set_trait</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">TraitError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="c1"># Roll back in case of TraitError during final cross validation.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">notify_change</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="kc">None</span>
                <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">changes</span> <span class="ow">in</span> <span class="n">cache</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">change</span> <span class="ow">in</span> <span class="n">changes</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="c1"># TODO: Separate in a rollback function per notification type.</span>
                        <span class="k">if</span> <span class="n">change</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;change&#39;</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">change</span><span class="o">.</span><span class="n">old</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Undefined</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">set_trait</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">change</span><span class="o">.</span><span class="n">old</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_trait_values</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="n">cache</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">raise</span> <span class="n">e</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_cross_validation_lock</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="c1"># Restore method retrieval from class</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">notify_change</span>

                <span class="c1"># trigger delayed notifications</span>
                <span class="k">for</span> <span class="n">changes</span> <span class="ow">in</span> <span class="n">cache</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">change</span> <span class="ow">in</span> <span class="n">changes</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">notify_change</span><span class="p">(</span><span class="n">change</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_notify_trait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">old_value</span><span class="p">,</span> <span class="n">new_value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">notify_change</span><span class="p">(</span><span class="n">Bunch</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">old</span><span class="o">=</span><span class="n">old_value</span><span class="p">,</span>
            <span class="n">new</span><span class="o">=</span><span class="n">new_value</span><span class="p">,</span>
            <span class="n">owner</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;change&#39;</span><span class="p">,</span>
        <span class="p">))</span>

    <span class="k">def</span> <span class="nf">notify_change</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Notify observers of a change event&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_notify_observers</span><span class="p">(</span><span class="n">change</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_notify_observers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Notify observers of any event&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">Bunch</span><span class="p">):</span>
            <span class="c1"># cast to bunch if given a dict</span>
            <span class="n">event</span> <span class="o">=</span> <span class="n">Bunch</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="n">name</span><span class="p">,</span> <span class="nb">type</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span>

        <span class="n">callables</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">callables</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_trait_notifiers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="p">[]))</span>
        <span class="n">callables</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_trait_notifiers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">All</span><span class="p">,</span> <span class="p">[]))</span>
        <span class="n">callables</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_trait_notifiers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">All</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="p">[]))</span>
        <span class="n">callables</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_trait_notifiers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">All</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">All</span><span class="p">,</span> <span class="p">[]))</span>

        <span class="c1"># Now static ones</span>
        <span class="n">magic_name</span> <span class="o">=</span> <span class="s1">&#39;_</span><span class="si">%s</span><span class="s1">_changed&#39;</span> <span class="o">%</span> <span class="n">name</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;change&quot;</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">magic_name</span><span class="p">):</span>
            <span class="n">class_value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">magic_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">class_value</span><span class="p">,</span> <span class="n">ObserveHandler</span><span class="p">):</span>
                <span class="n">_deprecated_method</span><span class="p">(</span><span class="n">class_value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">magic_name</span><span class="p">,</span>
                    <span class="s2">&quot;use @observe and @unobserve instead.&quot;</span><span class="p">)</span>
                <span class="n">cb</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">magic_name</span><span class="p">)</span>
                <span class="c1"># Only append the magic method if it was not manually registered</span>
                <span class="k">if</span> <span class="n">cb</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">callables</span><span class="p">:</span>
                    <span class="n">callables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_callback_wrapper</span><span class="p">(</span><span class="n">cb</span><span class="p">))</span>

        <span class="c1"># Call them all now</span>
        <span class="c1"># Traits catches and logs errors here.  I allow them to raise</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">callables</span><span class="p">:</span>
            <span class="c1"># Bound methods have an additional &#39;self&#39; argument.</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">_CallbackWrapper</span><span class="p">):</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="fm">__call__</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">EventHandler</span><span class="p">)</span> <span class="ow">and</span> <span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">c</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

            <span class="n">c</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_add_notifiers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trait_notifiers</span><span class="p">:</span>
            <span class="n">nlist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_trait_notifiers</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="nb">type</span><span class="p">:</span> <span class="n">nlist</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trait_notifiers</span><span class="p">[</span><span class="n">name</span><span class="p">]:</span>
                <span class="n">nlist</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_trait_notifiers</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="nb">type</span><span class="p">]</span> <span class="o">=</span> <span class="n">nlist</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">nlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trait_notifiers</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="nb">type</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">handler</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nlist</span><span class="p">:</span>
            <span class="n">nlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_remove_notifiers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">handler</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trait_notifiers</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="nb">type</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_trait_notifiers</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="nb">type</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">on_trait_change</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">remove</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;DEPRECATED: Setup a handler to be called when a trait changes.</span>

<span class="sd">        This is used to setup dynamic notifications of trait changes.</span>

<span class="sd">        Static handlers can be created by creating methods on a HasTraits</span>
<span class="sd">        subclass with the naming convention &#39;_[traitname]_changed&#39;.  Thus,</span>
<span class="sd">        to create static handler for the trait &#39;a&#39;, create the method</span>
<span class="sd">        _a_changed(self, name, old, new) (fewer arguments can be used, see</span>
<span class="sd">        below).</span>

<span class="sd">        If `remove` is True and `handler` is not specified, all change</span>
<span class="sd">        handlers for the specified name are uninstalled.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        handler : callable, None</span>
<span class="sd">            A callable that is called when a trait changes.  Its</span>
<span class="sd">            signature can be handler(), handler(name), handler(name, new),</span>
<span class="sd">            handler(name, old, new), or handler(name, old, new, self).</span>
<span class="sd">        name : list, str, None</span>
<span class="sd">            If None, the handler will apply to all traits.  If a list</span>
<span class="sd">            of str, handler will apply to all names in the list.  If a</span>
<span class="sd">            str, the handler will apply just to that name.</span>
<span class="sd">        remove : bool</span>
<span class="sd">            If False (the default), then install the handler.  If True</span>
<span class="sd">            then unintall it.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">warn</span><span class="p">(</span><span class="s2">&quot;on_trait_change is deprecated in traitlets 4.1: use observe instead&quot;</span><span class="p">,</span>
             <span class="ne">DeprecationWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">All</span>
        <span class="k">if</span> <span class="n">remove</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unobserve</span><span class="p">(</span><span class="n">_callback_wrapper</span><span class="p">(</span><span class="n">handler</span><span class="p">),</span> <span class="n">names</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">_callback_wrapper</span><span class="p">(</span><span class="n">handler</span><span class="p">),</span> <span class="n">names</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">observe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">All</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;change&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Setup a handler to be called when a trait changes.</span>

<span class="sd">        This is used to setup dynamic notifications of trait changes.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        handler : callable</span>
<span class="sd">            A callable that is called when a trait changes. Its</span>
<span class="sd">            signature should be ``handler(change)``, where ``change`` is a</span>
<span class="sd">            dictionary. The change dictionary at least holds a &#39;type&#39; key.</span>
<span class="sd">            * ``type``: the type of notification.</span>
<span class="sd">            Other keys may be passed depending on the value of &#39;type&#39;. In the</span>
<span class="sd">            case where type is &#39;change&#39;, we also have the following keys:</span>
<span class="sd">            * ``owner`` : the HasTraits instance</span>
<span class="sd">            * ``old`` : the old value of the modified trait attribute</span>
<span class="sd">            * ``new`` : the new value of the modified trait attribute</span>
<span class="sd">            * ``name`` : the name of the modified trait attribute.</span>
<span class="sd">        names : list, str, All</span>
<span class="sd">            If names is All, the handler will apply to all traits.  If a list</span>
<span class="sd">            of str, handler will apply to all names in the list.  If a</span>
<span class="sd">            str, the handler will apply just to that name.</span>
<span class="sd">        type : str, All (default: &#39;change&#39;)</span>
<span class="sd">            The type of notification to filter by. If equal to All, then all</span>
<span class="sd">            notifications are passed to the observe handler.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">names</span> <span class="o">=</span> <span class="n">parse_notifier_name</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_notifiers</span><span class="p">(</span><span class="n">handler</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">unobserve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">All</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;change&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove a trait change handler.</span>

<span class="sd">        This is used to unregister handlers to trait change notifications.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        handler : callable</span>
<span class="sd">            The callable called when a trait attribute changes.</span>
<span class="sd">        names : list, str, All (default: All)</span>
<span class="sd">            The names of the traits for which the specified handler should be</span>
<span class="sd">            uninstalled. If names is All, the specified handler is uninstalled</span>
<span class="sd">            from the list of notifiers corresponding to all changes.</span>
<span class="sd">        type : str or All (default: &#39;change&#39;)</span>
<span class="sd">            The type of notification to filter by. If All, the specified handler</span>
<span class="sd">            is uninstalled from the list of notifiers corresponding to all types.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">names</span> <span class="o">=</span> <span class="n">parse_notifier_name</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_remove_notifiers</span><span class="p">(</span><span class="n">handler</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">unobserve_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">All</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove trait change handlers of any type for the specified name.</span>
<span class="sd">        If name is not specified, removes all trait notifiers.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="n">All</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_trait_notifiers</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trait_notifiers</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_register_validator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">,</span> <span class="n">names</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Setup a handler to be called when a trait should be cross validated.</span>

<span class="sd">        This is used to setup dynamic notifications for cross-validation.</span>

<span class="sd">        If a validator is already registered for any of the provided names, a</span>
<span class="sd">        TraitError is raised and no new validator is registered.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        handler : callable</span>
<span class="sd">            A callable that is called when the given trait is cross-validated.</span>
<span class="sd">            Its signature is handler(proposal), where proposal is a Bunch (dictionary with attribute access)</span>
<span class="sd">            with the following attributes/keys:</span>
<span class="sd">                * ``owner`` : the HasTraits instance</span>
<span class="sd">                * ``value`` : the proposed value for the modified trait attribute</span>
<span class="sd">                * ``trait`` : the TraitType instance associated with the attribute</span>
<span class="sd">        names : List of strings</span>
<span class="sd">            The names of the traits that should be cross-validated</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="n">magic_name</span> <span class="o">=</span> <span class="s1">&#39;_</span><span class="si">%s</span><span class="s1">_validate&#39;</span> <span class="o">%</span> <span class="n">name</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">magic_name</span><span class="p">):</span>
                <span class="n">class_value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">magic_name</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">class_value</span><span class="p">,</span> <span class="n">ValidateHandler</span><span class="p">):</span>
                    <span class="n">_deprecated_method</span><span class="p">(</span><span class="n">class_value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">magic_name</span><span class="p">,</span>
                        <span class="s2">&quot;use @validate decorator instead.&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_trait_validators</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">handler</span>

    <span class="k">def</span> <span class="nf">add_traits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">traits</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Dynamically add trait attributes to the HasTraits instance.&quot;&quot;&quot;</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;__module__&quot;</span><span class="p">:</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__module__</span><span class="p">}</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s2">&quot;__qualname__&quot;</span><span class="p">):</span>
          <span class="c1"># __qualname__ introduced in Python 3.3 (see PEP 3155)</span>
          <span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;__qualname__&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__qualname__</span>
        <span class="n">attrs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">traits</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="p">(</span><span class="bp">cls</span><span class="p">,),</span> <span class="n">attrs</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">trait</span> <span class="ow">in</span> <span class="n">traits</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">trait</span><span class="o">.</span><span class="n">instance_init</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_trait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Forcibly sets trait attribute, including read-only attributes.&quot;&quot;&quot;</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_trait</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">TraitError</span><span class="p">(</span><span class="s2">&quot;Class </span><span class="si">%s</span><span class="s2"> does not have a trait named </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
                                <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">class_trait_names</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">metadata</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get a list of all the names of this class&#39; traits.</span>

<span class="sd">        This method is just like the :meth:`trait_names` method,</span>
<span class="sd">        but is unbound.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">class_traits</span><span class="p">(</span><span class="o">**</span><span class="n">metadata</span><span class="p">))</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">class_traits</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">metadata</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get a ``dict`` of all the traits of this class.  The dictionary</span>
<span class="sd">        is keyed on the name and the values are the TraitType objects.</span>

<span class="sd">        This method is just like the :meth:`traits` method, but is unbound.</span>

<span class="sd">        The TraitTypes returned don&#39;t know anything about the values</span>
<span class="sd">        that the various HasTrait&#39;s instances are holding.</span>

<span class="sd">        The metadata kwargs allow functions to be passed in which</span>
<span class="sd">        filter traits based on metadata values.  The functions should</span>
<span class="sd">        take a single value as an argument and return a boolean.  If</span>
<span class="sd">        any function returns False, then the trait is not included in</span>
<span class="sd">        the output.  If a metadata key doesn&#39;t exist, None will be passed</span>
<span class="sd">        to the function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">traits</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([</span><span class="n">memb</span> <span class="k">for</span> <span class="n">memb</span> <span class="ow">in</span> <span class="n">getmembers</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="k">if</span>
                     <span class="nb">isinstance</span><span class="p">(</span><span class="n">memb</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">TraitType</span><span class="p">)])</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">traits</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">trait</span> <span class="ow">in</span> <span class="n">traits</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">meta_name</span><span class="p">,</span> <span class="n">meta_eval</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">callable</span><span class="p">(</span><span class="n">meta_eval</span><span class="p">):</span>
                    <span class="n">meta_eval</span> <span class="o">=</span> <span class="n">_SimpleTest</span><span class="p">(</span><span class="n">meta_eval</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">meta_eval</span><span class="p">(</span><span class="n">trait</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">meta_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)):</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">trait</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">class_own_traits</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">metadata</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get a dict of all the traitlets defined on this class, not a parent.</span>

<span class="sd">        Works like `class_traits`, except for excluding traits from parents.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sup</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">n</span><span class="p">:</span> <span class="n">t</span> <span class="k">for</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">class_traits</span><span class="p">(</span><span class="o">**</span><span class="n">metadata</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">sup</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">t</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">has_trait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns True if the object has a trait with the specified name.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">TraitType</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">trait_has_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns True if the specified trait has a value.</span>

<span class="sd">        This will return false even if ``getattr`` would return a</span>
<span class="sd">        dynamically generated default value. These default values</span>
<span class="sd">        will be recognized as existing only after they have been</span>
<span class="sd">        generated.</span>

<span class="sd">        Example</span>

<span class="sd">        .. code-block:: python</span>
<span class="sd">            class MyClass(HasTraits):</span>
<span class="sd">                i = Int()</span>

<span class="sd">            mc = MyClass()</span>
<span class="sd">            assert not mc.trait_has_value(&quot;i&quot;)</span>
<span class="sd">            mc.i # generates a default value</span>
<span class="sd">            assert mc.trait_has_value(&quot;i&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trait_values</span>

    <span class="k">def</span> <span class="nf">trait_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">metadata</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A ``dict`` of trait names and their values.</span>

<span class="sd">        The metadata kwargs allow functions to be passed in which</span>
<span class="sd">        filter traits based on metadata values.  The functions should</span>
<span class="sd">        take a single value as an argument and return a boolean.  If</span>
<span class="sd">        any function returns False, then the trait is not included in</span>
<span class="sd">        the output.  If a metadata key doesn&#39;t exist, None will be passed</span>
<span class="sd">        to the function.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        A ``dict`` of trait names and their values.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Trait values are retrieved via ``getattr``, any exceptions raised</span>
<span class="sd">        by traits or the operations they may trigger will result in the</span>
<span class="sd">        absence of a trait value in the result ``dict``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trait_names</span><span class="p">(</span><span class="o">**</span><span class="n">metadata</span><span class="p">)}</span>

    <span class="k">def</span> <span class="nf">_get_trait_default_generator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return default generator for a given trait</span>

<span class="sd">        Walk the MRO to resolve the correct default generator according to inheritance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">method_name</span> <span class="o">=</span> <span class="s1">&#39;_</span><span class="si">%s</span><span class="s1">_default&#39;</span> <span class="o">%</span> <span class="n">name</span>
        <span class="k">if</span> <span class="n">method_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method_name</span><span class="p">)</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span>
        <span class="n">trait</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trait</span><span class="p">,</span> <span class="n">TraitType</span><span class="p">)</span>
        <span class="c1"># truncate mro to the class on which the trait is defined</span>
        <span class="n">mro</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">mro</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">mro</span> <span class="o">=</span> <span class="n">mro</span><span class="p">[:</span><span class="n">mro</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">trait</span><span class="o">.</span><span class="n">this_class</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="c1"># this_class not in mro</span>
            <span class="k">pass</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">mro</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">method_name</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">method_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;_trait_default_generators&#39;</span><span class="p">,</span> <span class="p">{}):</span>
                <span class="k">return</span> <span class="n">c</span><span class="o">.</span><span class="n">_trait_default_generators</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">trait</span><span class="o">.</span><span class="n">default</span>

    <span class="k">def</span> <span class="nf">trait_defaults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">names</span><span class="p">,</span> <span class="o">**</span><span class="n">metadata</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a trait&#39;s default value or a dictionary of them</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Dynamically generated default values may</span>
<span class="sd">        depend on the current state of the object.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_trait</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">TraitError</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="si">%s</span><span class="s2">&#39; is not a trait of &#39;</span><span class="si">%s</span><span class="s2">&#39; &quot;</span>
                    <span class="s2">&quot;instances&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_trait_default_generator</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">])(</span><span class="bp">self</span><span class="p">)</span>

        <span class="n">trait_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trait_names</span><span class="p">(</span><span class="o">**</span><span class="n">metadata</span><span class="p">)</span>
        <span class="n">trait_names</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>

        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">trait_names</span><span class="p">:</span>
            <span class="n">defaults</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_trait_default_generator</span><span class="p">(</span><span class="n">n</span><span class="p">)(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">defaults</span>

    <span class="k">def</span> <span class="nf">trait_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">metadata</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get a list of all the names of this class&#39; traits.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">traits</span><span class="p">(</span><span class="o">**</span><span class="n">metadata</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">traits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">metadata</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get a ``dict`` of all the traits of this class.  The dictionary</span>
<span class="sd">        is keyed on the name and the values are the TraitType objects.</span>

<span class="sd">        The TraitTypes returned don&#39;t know anything about the values</span>
<span class="sd">        that the various HasTrait&#39;s instances are holding.</span>

<span class="sd">        The metadata kwargs allow functions to be passed in which</span>
<span class="sd">        filter traits based on metadata values.  The functions should</span>
<span class="sd">        take a single value as an argument and return a boolean.  If</span>
<span class="sd">        any function returns False, then the trait is not included in</span>
<span class="sd">        the output.  If a metadata key doesn&#39;t exist, None will be passed</span>
<span class="sd">        to the function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">traits</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([</span><span class="n">memb</span> <span class="k">for</span> <span class="n">memb</span> <span class="ow">in</span> <span class="n">getmembers</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span> <span class="k">if</span>
                     <span class="nb">isinstance</span><span class="p">(</span><span class="n">memb</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">TraitType</span><span class="p">)])</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">traits</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">trait</span> <span class="ow">in</span> <span class="n">traits</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">meta_name</span><span class="p">,</span> <span class="n">meta_eval</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">callable</span><span class="p">(</span><span class="n">meta_eval</span><span class="p">):</span>
                    <span class="n">meta_eval</span> <span class="o">=</span> <span class="n">_SimpleTest</span><span class="p">(</span><span class="n">meta_eval</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">meta_eval</span><span class="p">(</span><span class="n">trait</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">meta_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)):</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">trait</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">trait_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">traitname</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get metadata values for trait by key.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">trait</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">traitname</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">TraitError</span><span class="p">(</span><span class="s2">&quot;Class </span><span class="si">%s</span><span class="s2"> does not have a trait named </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
                                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">traitname</span><span class="p">))</span>
        <span class="n">metadata_name</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">traitname</span> <span class="o">+</span> <span class="s1">&#39;_metadata&#39;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metadata_name</span><span class="p">)</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metadata_name</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metadata_name</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">trait</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">class_own_trait_events</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get a dict of all event handlers defined on this class, not a parent.</span>

<span class="sd">        Works like ``event_handlers``, except for excluding traits from parents.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sup</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">n</span><span class="p">:</span> <span class="n">e</span> <span class="k">for</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">events</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">sup</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">e</span><span class="p">}</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">trait_events</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get a ``dict`` of all the event handlers of this class.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str (default: None)</span>
<span class="sd">            The name of a trait of this class. If name is ``None`` then all</span>
<span class="sd">            the event handlers of this class will be returned instead.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        The event handlers associated with a trait name, or all event handlers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">events</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">getmembers</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">EventHandler</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">events</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
                <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">trait_names</span><span class="p">:</span>
                    <span class="n">events</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
                <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="s1">&#39;tags&#39;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">trait_names</span><span class="p">(</span><span class="o">**</span><span class="n">v</span><span class="o">.</span><span class="n">tags</span><span class="p">):</span>
                        <span class="n">events</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">return</span> <span class="n">events</span>

<span class="c1">#-----------------------------------------------------------------------------</span>
<span class="c1"># Actual TraitTypes implementations/subclasses</span>
<span class="c1">#-----------------------------------------------------------------------------</span>

<span class="c1">#-----------------------------------------------------------------------------</span>
<span class="c1"># TraitTypes subclasses for handling classes and instances of classes</span>
<span class="c1">#-----------------------------------------------------------------------------</span>


<span class="k">class</span> <span class="nc">ClassBasedTraitType</span><span class="p">(</span><span class="n">TraitType</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A trait with error reporting and string -&gt; type resolution for Type,</span>
<span class="sd">    Instance and This.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_resolve_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resolve a string supplied for a type into an actual object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">import_item</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Type</span><span class="p">(</span><span class="n">ClassBasedTraitType</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A trait whose value must be a subclass of a specified class.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Construct a Type trait</span>

<span class="sd">        A Type trait specifies that its values must be subclasses of</span>
<span class="sd">        a particular class.</span>

<span class="sd">        If only ``default_value`` is given, it is used for the ``klass`` as</span>
<span class="sd">        well. If neither are given, both default to ``object``.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        default_value : class, str or None</span>
<span class="sd">            The default value must be a subclass of klass.  If an str,</span>
<span class="sd">            the str must be a fully specified class name, like &#39;foo.bar.Bah&#39;.</span>
<span class="sd">            The string is resolved into real class, when the parent</span>
<span class="sd">            :class:`HasTraits` class is instantiated.</span>
<span class="sd">        klass : class, str [ default object ]</span>
<span class="sd">            Values of this trait must be a subclass of klass.  The klass</span>
<span class="sd">            may be specified in a string like: &#39;foo.bar.MyClass&#39;.</span>
<span class="sd">            The string is resolved into real class, when the parent</span>
<span class="sd">            :class:`HasTraits` class is instantiated.</span>
<span class="sd">        allow_none : bool [ default False ]</span>
<span class="sd">            Indicates whether None is allowed as an assignable value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">default_value</span> <span class="ow">is</span> <span class="n">Undefined</span><span class="p">:</span>
            <span class="n">new_default_value</span> <span class="o">=</span> <span class="nb">object</span> <span class="k">if</span> <span class="p">(</span><span class="n">klass</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="k">else</span> <span class="n">klass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_default_value</span> <span class="o">=</span> <span class="n">default_value</span>

        <span class="k">if</span> <span class="n">klass</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">default_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">default_value</span> <span class="ow">is</span> <span class="n">Undefined</span><span class="p">):</span>
                <span class="n">klass</span> <span class="o">=</span> <span class="nb">object</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">klass</span> <span class="o">=</span> <span class="n">default_value</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="n">klass</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">klass</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">TraitError</span><span class="p">(</span><span class="s2">&quot;A Type trait must specify a class.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">klass</span> <span class="o">=</span> <span class="n">klass</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">new_default_value</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validates that the value is a valid object instance.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_string</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">TraitError</span><span class="p">(</span><span class="s2">&quot;The &#39;</span><span class="si">%s</span><span class="s2">&#39; trait of </span><span class="si">%s</span><span class="s2"> instance must be a type, but &quot;</span>
                                 <span class="s2">&quot;</span><span class="si">%r</span><span class="s2"> could not be imported&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">klass</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">value</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns a description of the trait.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">klass</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">klass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">klass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">klass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">klass</span><span class="o">.</span><span class="vm">__module__</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">klass</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;a subclass of &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">klass</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_none</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result</span> <span class="o">+</span> <span class="s1">&#39; or None&#39;</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">instance_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_classes</span><span class="p">()</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">instance_init</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_resolve_classes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">klass</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">klass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">klass</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default_value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default_value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">default_value_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_value</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="o">.</span><span class="vm">__module__</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">value</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Instance</span><span class="p">(</span><span class="n">ClassBasedTraitType</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A trait whose value must be an instance of a specified class.</span>

<span class="sd">    The value can also be an instance of a subclass of the specified class.</span>

<span class="sd">    Subclasses can declare default classes by overriding the klass attribute</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">klass</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kw</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Construct an Instance trait.</span>

<span class="sd">        This trait allows values that are instances of a particular</span>
<span class="sd">        class or its subclasses.  Our implementation is quite different</span>
<span class="sd">        from that of enthough.traits as we don&#39;t allow instances to be used</span>
<span class="sd">        for klass and we handle the ``args`` and ``kw`` arguments differently.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        klass : class, str</span>
<span class="sd">            The class that forms the basis for the trait.  Class names</span>
<span class="sd">            can also be specified as strings, like &#39;foo.bar.Bar&#39;.</span>
<span class="sd">        args : tuple</span>
<span class="sd">            Positional arguments for generating the default value.</span>
<span class="sd">        kw : dict</span>
<span class="sd">            Keyword arguments for generating the default value.</span>
<span class="sd">        allow_none : bool [ default False ]</span>
<span class="sd">            Indicates whether None is allowed as a value.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        If both ``args`` and ``kw`` are None, then the default value is None.</span>
<span class="sd">        If ``args`` is a tuple and ``kw`` is a dict, then the default is</span>
<span class="sd">        created as ``klass(*args, **kw)``.  If exactly one of ``args`` or ``kw`` is</span>
<span class="sd">        None, the None is replaced by ``()`` or ``{}``, respectively.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">klass</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">klass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">klass</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">klass</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="n">klass</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">klass</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">klass</span> <span class="o">=</span> <span class="n">klass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">TraitError</span><span class="p">(</span><span class="s1">&#39;The klass attribute must be a class&#39;</span>
                                <span class="s1">&#39; not: </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">klass</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">kw</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kw</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">TraitError</span><span class="p">(</span><span class="s2">&quot;The &#39;kw&#39; argument must be a dict or None.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">args</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">TraitError</span><span class="p">(</span><span class="s2">&quot;The &#39;args&#39; argument must be a tuple or None.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">default_args</span> <span class="o">=</span> <span class="n">args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_kwargs</span> <span class="o">=</span> <span class="n">kw</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">Instance</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">klass</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">klass</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">add_article</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">klass</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">describe</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">klass</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_none</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="s1">&#39; or None&#39;</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">instance_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_classes</span><span class="p">()</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">instance_init</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_resolve_classes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">klass</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">klass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">klass</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">make_dynamic_default</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default_args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default_kwargs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">klass</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default_args</span> <span class="ow">or</span> <span class="p">()),</span>
                          <span class="o">**</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default_kwargs</span> <span class="ow">or</span> <span class="p">{}))</span>

    <span class="k">def</span> <span class="nf">default_value_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">make_dynamic_default</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">from_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_safe_literal_eval</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ForwardDeclaredMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Mixin for forward-declared versions of Instance and Type.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_resolve_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find the specified class name by looking for it in the module in which</span>
<span class="sd">        our this_class attribute was defined.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">modname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">this_class</span><span class="o">.</span><span class="vm">__module__</span>
        <span class="k">return</span> <span class="n">import_item</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">modname</span><span class="p">,</span> <span class="n">string</span><span class="p">]))</span>


<span class="k">class</span> <span class="nc">ForwardDeclaredType</span><span class="p">(</span><span class="n">ForwardDeclaredMixin</span><span class="p">,</span> <span class="n">Type</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Forward-declared version of Type.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">ForwardDeclaredInstance</span><span class="p">(</span><span class="n">ForwardDeclaredMixin</span><span class="p">,</span> <span class="n">Instance</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Forward-declared version of Instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">This</span><span class="p">(</span><span class="n">ClassBasedTraitType</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A trait for instances of the class containing this trait.</span>

<span class="sd">    Because how how and when class bodies are executed, the ``This``</span>
<span class="sd">    trait can only have a default value of None.  This, and because we</span>
<span class="sd">    always validate default values, ``allow_none`` is *always* true.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">info_text</span> <span class="o">=</span> <span class="s1">&#39;an instance of the same type as the receiver or None&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">This</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="c1"># What if value is a superclass of obj.__class__?  This is</span>
        <span class="c1"># complicated if it was the superclass that defined the This</span>
        <span class="c1"># trait.</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">this_class</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Union</span><span class="p">(</span><span class="n">TraitType</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A trait type representing a Union type.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trait_types</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Construct a Union  trait.</span>

<span class="sd">        This trait allows values that are allowed by at least one of the</span>
<span class="sd">        specified trait types. A Union traitlet cannot have metadata on</span>
<span class="sd">        its own, besides the metadata of the listed types.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        trait_types : sequence</span>
<span class="sd">            The list of trait types of length at least 1.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Union([Float(), Bool(), Int()]) attempts to validate the provided values</span>
<span class="sd">        with the validation function of Float, then Bool, and finally Int.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trait_types</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">trait_types</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info_text</span> <span class="o">=</span> <span class="s2">&quot; or &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">tt</span><span class="o">.</span><span class="n">info</span><span class="p">()</span> <span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trait_types</span><span class="p">])</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Union</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">default</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Union</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trait_types</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="n">Undefined</span><span class="p">:</span>
                <span class="n">default</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">return</span> <span class="n">default</span>

    <span class="k">def</span> <span class="nf">class_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">trait_type</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trait_types</span><span class="p">):</span>
            <span class="n">trait_type</span><span class="o">.</span><span class="n">class_init</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Union</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">class_init</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">instance_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">trait_type</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trait_types</span><span class="p">):</span>
            <span class="n">trait_type</span><span class="o">.</span><span class="n">instance_init</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Union</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">instance_init</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">obj</span><span class="o">.</span><span class="n">cross_validation_lock</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">trait_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trait_types</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="n">trait_type</span><span class="o">.</span><span class="n">_validate</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                    <span class="c1"># In the case of an element trait, the name is None</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_metadata&#39;</span><span class="p">,</span> <span class="n">trait_type</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">v</span>
                <span class="k">except</span> <span class="n">TraitError</span><span class="p">:</span>
                    <span class="k">continue</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__or__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Union</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">Union</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trait_types</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">trait_types</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Union</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trait_types</span> <span class="o">+</span> <span class="p">[</span><span class="n">other</span><span class="p">])</span>


<span class="c1">#-----------------------------------------------------------------------------</span>
<span class="c1"># Basic TraitTypes implementations/subclasses</span>
<span class="c1">#-----------------------------------------------------------------------------</span>


<span class="k">class</span> <span class="nc">Any</span><span class="p">(</span><span class="n">TraitType</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A trait which allows any value.&quot;&quot;&quot;</span>
    <span class="n">default_value</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">allow_none</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">info_text</span> <span class="o">=</span> <span class="s1">&#39;any value&#39;</span>


<span class="k">def</span> <span class="nf">_validate_bounds</span><span class="p">(</span><span class="n">trait</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate that a number to be applied to a trait is between bounds.</span>

<span class="sd">    If value is not between min_bound and max_bound, this raises a</span>
<span class="sd">    TraitError with an error message appropriate for this trait.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">trait</span><span class="o">.</span><span class="n">min</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="n">trait</span><span class="o">.</span><span class="n">min</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">TraitError</span><span class="p">(</span>
            <span class="s2">&quot;The value of the &#39;</span><span class="si">{name}</span><span class="s2">&#39; trait of </span><span class="si">{klass}</span><span class="s2"> instance should &quot;</span>
            <span class="s2">&quot;not be less than </span><span class="si">{min_bound}</span><span class="s2">, but a value of </span><span class="si">{value}</span><span class="s2"> was &quot;</span>
            <span class="s2">&quot;specified&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">trait</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="n">class_of</span><span class="p">(</span><span class="n">obj</span><span class="p">),</span>
                <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">min_bound</span><span class="o">=</span><span class="n">trait</span><span class="o">.</span><span class="n">min</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">trait</span><span class="o">.</span><span class="n">max</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="n">trait</span><span class="o">.</span><span class="n">max</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">TraitError</span><span class="p">(</span>
            <span class="s2">&quot;The value of the &#39;</span><span class="si">{name}</span><span class="s2">&#39; trait of </span><span class="si">{klass}</span><span class="s2"> instance should &quot;</span>
            <span class="s2">&quot;not be greater than </span><span class="si">{max_bound}</span><span class="s2">, but a value of </span><span class="si">{value}</span><span class="s2"> was &quot;</span>
            <span class="s2">&quot;specified&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">trait</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="n">class_of</span><span class="p">(</span><span class="n">obj</span><span class="p">),</span>
                <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">max_bound</span><span class="o">=</span><span class="n">trait</span><span class="o">.</span><span class="n">max</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">value</span>


<span class="k">class</span> <span class="nc">Int</span><span class="p">(</span><span class="n">TraitType</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An int trait.&quot;&quot;&quot;</span>

    <span class="n">default_value</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">info_text</span> <span class="o">=</span> <span class="s1">&#39;an int&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Int</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">default_value</span><span class="o">=</span><span class="n">default_value</span><span class="p">,</span>
                                  <span class="n">allow_none</span><span class="o">=</span><span class="n">allow_none</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_validate_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">from_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_none</span> <span class="ow">and</span> <span class="n">s</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">CInt</span><span class="p">(</span><span class="n">Int</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A casting version of the int trait.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_validate_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>


<span class="n">Long</span><span class="p">,</span> <span class="n">CLong</span> <span class="o">=</span> <span class="n">Int</span><span class="p">,</span> <span class="n">CInt</span>
<span class="n">Integer</span> <span class="o">=</span> <span class="n">Int</span>


<span class="k">class</span> <span class="nc">Float</span><span class="p">(</span><span class="n">TraitType</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A float trait.&quot;&quot;&quot;</span>

    <span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">info_text</span> <span class="o">=</span> <span class="s1">&#39;a float&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">))</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Float</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">default_value</span><span class="o">=</span><span class="n">default_value</span><span class="p">,</span>
                                    <span class="n">allow_none</span><span class="o">=</span><span class="n">allow_none</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_validate_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">from_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_none</span> <span class="ow">and</span> <span class="n">s</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">CFloat</span><span class="p">(</span><span class="n">Float</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A casting version of the float trait.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_validate_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Complex</span><span class="p">(</span><span class="n">TraitType</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A trait for complex numbers.&quot;&quot;&quot;</span>

    <span class="n">default_value</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="o">+</span> <span class="mf">0.0</span><span class="n">j</span>
    <span class="n">info_text</span> <span class="o">=</span> <span class="s1">&#39;a complex number&#39;</span>

    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">complex</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
            <span class="k">return</span> <span class="nb">complex</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">from_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_none</span> <span class="ow">and</span> <span class="n">s</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="nb">complex</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">CComplex</span><span class="p">(</span><span class="n">Complex</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A casting version of the complex number trait.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">validate</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">complex</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

<span class="c1"># We should always be explicit about whether we&#39;re using bytes or unicode, both</span>
<span class="c1"># for Python 3 conversion and for reliable unicode behaviour on Python 2. So</span>
<span class="c1"># we don&#39;t have a Str type.</span>
<span class="k">class</span> <span class="nc">Bytes</span><span class="p">(</span><span class="n">TraitType</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A trait for byte strings.&quot;&quot;&quot;</span>

    <span class="n">default_value</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
    <span class="n">info_text</span> <span class="o">=</span> <span class="s1">&#39;a bytes object&#39;</span>

    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">from_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_none</span> <span class="ow">and</span> <span class="n">s</span> <span class="o">==</span> <span class="s2">&quot;None&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="c1"># handle deprecated b&quot;string&quot;</span>
            <span class="k">for</span> <span class="n">quote</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">s</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="sa">f</span><span class="s2">&quot;b</span><span class="si">{</span><span class="n">quote</span><span class="si">}</span><span class="s2">&quot;</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">quote</span><span class="p">:</span>
                    <span class="n">old_s</span> <span class="o">=</span> <span class="n">s</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">warn</span><span class="p">(</span>
                        <span class="s2">&quot;Supporting extra quotes around Bytes is deprecated in traitlets 5.0. &quot;</span>
                        <span class="s2">&quot;Use </span><span class="si">%r</span><span class="s2"> instead of </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">old_s</span><span class="p">),</span>
                        <span class="ne">FutureWarning</span><span class="p">)</span>
                    <span class="k">break</span>
        <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">CBytes</span><span class="p">(</span><span class="n">Bytes</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A casting version of the byte string trait.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Unicode</span><span class="p">(</span><span class="n">TraitType</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A trait for unicode strings.&quot;&quot;&quot;</span>

    <span class="n">default_value</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">info_text</span> <span class="o">=</span> <span class="s1">&#39;a unicode string&#39;</span>

    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="s1">&#39;strict&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Could not decode </span><span class="si">{!r}</span><span class="s2"> for unicode trait &#39;</span><span class="si">{}</span><span class="s2">&#39; of </span><span class="si">{}</span><span class="s2"> instance.&quot;</span>
                <span class="k">raise</span> <span class="n">TraitError</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">class_of</span><span class="p">(</span><span class="n">obj</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">from_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_none</span> <span class="ow">and</span> <span class="n">s</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c1"># handle deprecated &quot;1&quot;</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">s</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">c</span><span class="p">:</span>
                    <span class="n">old_s</span> <span class="o">=</span> <span class="n">s</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">warn</span><span class="p">(</span>
                        <span class="s2">&quot;Supporting extra quotes around Unicode is deprecated in traitlets 5.0. &quot;</span>
                        <span class="s2">&quot;Use </span><span class="si">%r</span><span class="s2"> instead of </span><span class="si">%r</span><span class="s2"> – or use CUnicode.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">old_s</span><span class="p">),</span>
                        <span class="ne">FutureWarning</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span>



<span class="k">class</span> <span class="nc">CUnicode</span><span class="p">(</span><span class="n">Unicode</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A casting version of the unicode trait.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ObjectName</span><span class="p">(</span><span class="n">TraitType</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A string holding a valid object name in this version of Python.</span>

<span class="sd">    This does not check that the name exists in any scope.&quot;&quot;&quot;</span>
    <span class="n">info_text</span> <span class="o">=</span> <span class="s2">&quot;a valid object identifier in Python&quot;</span>

    <span class="n">coerce_str</span> <span class="o">=</span> <span class="nb">staticmethod</span><span class="p">(</span><span class="k">lambda</span> <span class="n">_</span><span class="p">,</span><span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coerce_str</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">isidentifier</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">from_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_none</span> <span class="ow">and</span> <span class="n">s</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">s</span>

<span class="k">class</span> <span class="nc">DottedObjectName</span><span class="p">(</span><span class="n">ObjectName</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A string holding a valid dotted object name in Python, such as A.b3._c&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coerce_str</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">isidentifier</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
          <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Bool</span><span class="p">(</span><span class="n">TraitType</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A boolean (True, False) trait.&quot;&quot;&quot;</span>

    <span class="n">default_value</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">info_text</span> <span class="o">=</span> <span class="s1">&#39;a boolean&#39;</span>

    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">from_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_none</span> <span class="ow">and</span> <span class="n">s</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">{</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">}:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">{</span><span class="s1">&#39;false&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">}:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%r</span><span class="s2"> is not 1, 0, true, or false&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">CBool</span><span class="p">(</span><span class="n">Bool</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A casting version of the boolean trait.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Enum</span><span class="p">(</span><span class="n">TraitType</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An enum whose value must be in a given sequence.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">values</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;allow_none&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="n">default_value</span> <span class="ow">is</span> <span class="n">Undefined</span><span class="p">:</span>
            <span class="n">default_value</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Enum</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">default_value</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_choices_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">as_rst</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns a description of the trait choices (not none).&quot;&quot;&quot;</span>
        <span class="n">choices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span>
        <span class="k">if</span> <span class="n">as_rst</span><span class="p">:</span>
            <span class="n">choices</span> <span class="o">=</span> <span class="s1">&#39;|&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;``</span><span class="si">%r</span><span class="s1">``&#39;</span> <span class="o">%</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">choices</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">choices</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">choices</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">choices</span>

    <span class="k">def</span> <span class="nf">_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">as_rst</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns a description of the trait.&quot;&quot;&quot;</span>
        <span class="n">none</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39; or </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;`None`&#39;</span> <span class="k">if</span> <span class="n">as_rst</span> <span class="k">else</span> <span class="s1">&#39;None&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_none</span> <span class="k">else</span>
                <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39;any of </span><span class="si">%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_choices_str</span><span class="p">(</span><span class="n">as_rst</span><span class="p">),</span> <span class="n">none</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">(</span><span class="n">as_rst</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">info_rst</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">(</span><span class="n">as_rst</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">from_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">TraitError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_safe_literal_eval</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">CaselessStrEnum</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An enum of strings where the case should be ignored.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="n">default_value</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">v</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">as_rst</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns a description of the trait.&quot;&quot;&quot;</span>
        <span class="n">none</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39; or </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;`None`&#39;</span> <span class="k">if</span> <span class="n">as_rst</span> <span class="k">else</span> <span class="s1">&#39;None&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_none</span> <span class="k">else</span>
                <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39;any of </span><span class="si">%s</span><span class="s1"> (case-insensitive)</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_choices_str</span><span class="p">(</span><span class="n">as_rst</span><span class="p">),</span> <span class="n">none</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">(</span><span class="n">as_rst</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">info_rst</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">(</span><span class="n">as_rst</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">FuzzyEnum</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An case-ignoring enum matching choices by unique prefixes/substrings.&quot;&quot;&quot;</span>

    <span class="n">case_sensitive</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="c1">#: If True, choices match anywhere in the string, otherwise match prefixes.</span>
    <span class="n">substring_matching</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span>
                 <span class="n">case_sensitive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">substring_matching</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">case_sensitive</span> <span class="o">=</span> <span class="n">case_sensitive</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">substring_matching</span> <span class="o">=</span> <span class="n">substring_matching</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="n">default_value</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="n">conv_func</span> <span class="o">=</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">c</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">case_sensitive</span> <span class="k">else</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">substring_matching</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">substring_matching</span>
        <span class="n">match_func</span> <span class="o">=</span> <span class="p">((</span><span class="k">lambda</span> <span class="n">v</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">c</span><span class="p">)</span>
                      <span class="k">if</span> <span class="n">substring_matching</span>
                      <span class="k">else</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">v</span><span class="p">)))</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">conv_func</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="n">choices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="p">[</span><span class="n">match_func</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">conv_func</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">choices</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">v</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">choices</span><span class="p">,</span> <span class="n">matches</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">v</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">as_rst</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns a description of the trait.&quot;&quot;&quot;</span>
        <span class="n">none</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39; or </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;`None`&#39;</span> <span class="k">if</span> <span class="n">as_rst</span> <span class="k">else</span> <span class="s1">&#39;None&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_none</span> <span class="k">else</span>
                <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">case</span> <span class="o">=</span> <span class="s1">&#39;sensitive&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">case_sensitive</span> <span class="k">else</span> <span class="s1">&#39;insensitive&#39;</span>
        <span class="n">substr</span> <span class="o">=</span> <span class="s1">&#39;substring&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">substring_matching</span> <span class="k">else</span> <span class="s1">&#39;prefix&#39;</span>
        <span class="k">return</span> <span class="s1">&#39;any case-</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> of </span><span class="si">%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">case</span><span class="p">,</span> <span class="n">substr</span><span class="p">,</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">_choices_str</span><span class="p">(</span><span class="n">as_rst</span><span class="p">),</span>
                                           <span class="n">none</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">(</span><span class="n">as_rst</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">info_rst</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">(</span><span class="n">as_rst</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Container</span><span class="p">(</span><span class="n">Instance</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An instance of a container (list, set, etc.)</span>

<span class="sd">    To be subclassed by overriding klass.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">klass</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_cast_types</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">_valid_defaults</span> <span class="o">=</span> <span class="n">SequenceTypes</span>
    <span class="n">_trait</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trait</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a container trait type from a list, set, or tuple.</span>

<span class="sd">        The default value is created by doing ``List(default_value)``,</span>
<span class="sd">        which creates a copy of the ``default_value``.</span>

<span class="sd">        ``trait`` can be specified, which restricts the type of elements</span>
<span class="sd">        in the container to that TraitType.</span>

<span class="sd">        If only one arg is given and it is not a Trait, it is taken as</span>
<span class="sd">        ``default_value``:</span>

<span class="sd">        ``c = List([1, 2, 3])``</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        trait : TraitType [ optional ]</span>
<span class="sd">            the type for restricting the contents of the Container.  If unspecified,</span>
<span class="sd">            types are not checked.</span>
<span class="sd">        default_value : SequenceType [ optional ]</span>
<span class="sd">            The default value for the Trait.  Must be list/tuple/set, and</span>
<span class="sd">            will be cast to the container type.</span>
<span class="sd">        allow_none : bool [ default False ]</span>
<span class="sd">            Whether to allow the value to be None</span>
<span class="sd">        **kwargs : any</span>
<span class="sd">            further keys for extensions to the Trait (e.g. config)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># allow List([values]):</span>
        <span class="k">if</span> <span class="n">default_value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_trait</span><span class="p">(</span><span class="n">trait</span><span class="p">):</span>
            <span class="n">default_value</span> <span class="o">=</span> <span class="n">trait</span>
            <span class="n">trait</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">default_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">default_value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_defaults</span><span class="p">):</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">default_value</span><span class="p">,)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;default value of </span><span class="si">%s</span><span class="s1"> was </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">default_value</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">is_trait</span><span class="p">(</span><span class="n">trait</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trait</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
                <span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Traits should be given as instances, not types (for example, `Int()`, not `Int`).&quot;</span>
                     <span class="s2">&quot; Passing types is deprecated in traitlets 4.1.&quot;</span><span class="p">,</span>
                     <span class="ne">DeprecationWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_trait</span> <span class="o">=</span> <span class="n">trait</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trait</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span> <span class="k">else</span> <span class="n">trait</span>
        <span class="k">elif</span> <span class="n">trait</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;`trait` must be a Trait or None, got </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">repr_type</span><span class="p">(</span><span class="n">trait</span><span class="p">))</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">Container</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">klass</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">klass</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cast_types</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">klass</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Container</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span>

        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_elements</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">validate_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">validated</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trait</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_trait</span><span class="p">,</span> <span class="n">Any</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trait</span><span class="o">.</span><span class="n">_validate</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">TraitError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">validated</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">klass</span><span class="p">(</span><span class="n">validated</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">class_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_trait</span><span class="p">,</span> <span class="n">TraitType</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_trait</span><span class="o">.</span><span class="n">class_init</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Container</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">class_init</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">instance_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_trait</span><span class="p">,</span> <span class="n">TraitType</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_trait</span><span class="o">.</span><span class="n">instance_init</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Container</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">instance_init</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">from_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load value from a single string&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">TraitError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expected string, got </span><span class="si">{</span><span class="n">s</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">test</span> <span class="o">=</span> <span class="n">literal_eval</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">test</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">from_string_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the value from a list of config strings</span>

<span class="sd">        This is where we parse CLI configuration</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># check for deprecated --Class.trait=&quot;[&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]&quot;</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">s_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">r</span> <span class="o">==</span> <span class="s2">&quot;None&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_none</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;[&#39;</span> <span class="ow">and</span> <span class="n">r</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;]&#39;</span><span class="p">)</span> <span class="ow">or</span>
                <span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;(&#39;</span> <span class="ow">and</span> <span class="n">r</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="n">warn</span><span class="p">(</span>
                    <span class="s2">&quot;--</span><span class="si">{0}</span><span class="s2">=</span><span class="si">{1}</span><span class="s2"> for containers is deprecated in traitlets 5.0. &quot;</span>
                    <span class="s2">&quot;You can pass --</span><span class="si">{0}</span><span class="s2"> item ... multiple times to add items to a list.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">r</span><span class="p">),</span>
                    <span class="ne">FutureWarning</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">klass</span><span class="p">(</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">klass</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">item_from_string</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">s_list</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">item_from_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Cast a single item from a string</span>

<span class="sd">        Evaluated when parsing CLI configuration from a string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trait</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trait</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">s</span>


<span class="k">class</span> <span class="nc">List</span><span class="p">(</span><span class="n">Container</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An instance of a Python list.&quot;&quot;&quot;</span>
    <span class="n">klass</span> <span class="o">=</span> <span class="nb">list</span>
    <span class="n">_cast_types</span> <span class="o">=</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trait</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">minlen</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxlen</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a List trait type from a list, set, or tuple.</span>

<span class="sd">        The default value is created by doing ``list(default_value)``,</span>
<span class="sd">        which creates a copy of the ``default_value``.</span>

<span class="sd">        ``trait`` can be specified, which restricts the type of elements</span>
<span class="sd">        in the container to that TraitType.</span>

<span class="sd">        If only one arg is given and it is not a Trait, it is taken as</span>
<span class="sd">        ``default_value``:</span>

<span class="sd">        ``c = List([1, 2, 3])``</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        trait : TraitType [ optional ]</span>
<span class="sd">            the type for restricting the contents of the Container.</span>
<span class="sd">            If unspecified, types are not checked.</span>
<span class="sd">        default_value : SequenceType [ optional ]</span>
<span class="sd">            The default value for the Trait.  Must be list/tuple/set, and</span>
<span class="sd">            will be cast to the container type.</span>
<span class="sd">        minlen : Int [ default 0 ]</span>
<span class="sd">            The minimum length of the input list</span>
<span class="sd">        maxlen : Int [ default sys.maxsize ]</span>
<span class="sd">            The maximum length of the input list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_minlen</span> <span class="o">=</span> <span class="n">minlen</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_maxlen</span> <span class="o">=</span> <span class="n">maxlen</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">List</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">trait</span><span class="o">=</span><span class="n">trait</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="n">default_value</span><span class="p">,</span>
                                   <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">length_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">e</span> <span class="o">=</span> <span class="s2">&quot;The &#39;</span><span class="si">%s</span><span class="s2">&#39; trait of </span><span class="si">%s</span><span class="s2"> instance must be of length </span><span class="si">%i</span><span class="s2"> &lt;= L &lt;= </span><span class="si">%i</span><span class="s2">, but a value of </span><span class="si">%s</span><span class="s2"> was specified.&quot;</span> \
            <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">class_of</span><span class="p">(</span><span class="n">obj</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minlen</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maxlen</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">TraitError</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">validate_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">length</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minlen</span> <span class="ow">or</span> <span class="n">length</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maxlen</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">length_error</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">List</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">validate_elements</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Set</span><span class="p">(</span><span class="n">List</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An instance of a Python set.&quot;&quot;&quot;</span>
    <span class="n">klass</span> <span class="o">=</span> <span class="nb">set</span>
    <span class="n">_cast_types</span> <span class="o">=</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>

    <span class="c1"># Redefine __init__ just to make the docstring more accurate.</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trait</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">minlen</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxlen</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a Set trait type from a list, set, or tuple.</span>

<span class="sd">        The default value is created by doing ``set(default_value)``,</span>
<span class="sd">        which creates a copy of the ``default_value``.</span>

<span class="sd">        ``trait`` can be specified, which restricts the type of elements</span>
<span class="sd">        in the container to that TraitType.</span>

<span class="sd">        If only one arg is given and it is not a Trait, it is taken as</span>
<span class="sd">        ``default_value``:</span>

<span class="sd">        ``c = Set({1, 2, 3})``</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        trait : TraitType [ optional ]</span>
<span class="sd">            the type for restricting the contents of the Container.</span>
<span class="sd">            If unspecified, types are not checked.</span>
<span class="sd">        default_value : SequenceType [ optional ]</span>
<span class="sd">            The default value for the Trait.  Must be list/tuple/set, and</span>
<span class="sd">            will be cast to the container type.</span>
<span class="sd">        minlen : Int [ default 0 ]</span>
<span class="sd">            The minimum length of the input list</span>
<span class="sd">        maxlen : Int [ default sys.maxsize ]</span>
<span class="sd">            The maximum length of the input list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Set</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">trait</span><span class="p">,</span> <span class="n">default_value</span><span class="p">,</span> <span class="n">minlen</span><span class="p">,</span> <span class="n">maxlen</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">default_value_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Ensure default value is sorted for a reproducible build</span>
        <span class="n">list_repr</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">make_dynamic_default</span><span class="p">()))</span>
        <span class="k">if</span> <span class="n">list_repr</span> <span class="o">==</span> <span class="s1">&#39;[]&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;set()&#39;</span>
        <span class="k">return</span> <span class="s1">&#39;{&#39;</span><span class="o">+</span><span class="n">list_repr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;}&#39;</span>


<span class="k">class</span> <span class="nc">Tuple</span><span class="p">(</span><span class="n">Container</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An instance of a Python tuple.&quot;&quot;&quot;</span>
    <span class="n">klass</span> <span class="o">=</span> <span class="nb">tuple</span>
    <span class="n">_cast_types</span> <span class="o">=</span> <span class="p">(</span><span class="nb">list</span><span class="p">,)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">traits</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a tuple from a list, set, or tuple.</span>

<span class="sd">        Create a fixed-type tuple with Traits:</span>

<span class="sd">        ``t = Tuple(Int(), Str(), CStr())``</span>

<span class="sd">        would be length 3, with Int,Str,CStr for each element.</span>

<span class="sd">        If only one arg is given and it is not a Trait, it is taken as</span>
<span class="sd">        default_value:</span>

<span class="sd">        ``t = Tuple((1, 2, 3))``</span>

<span class="sd">        Otherwise, ``default_value`` *must* be specified by keyword.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        `*traits` : TraitTypes [ optional ]</span>
<span class="sd">            the types for restricting the contents of the Tuple.  If unspecified,</span>
<span class="sd">            types are not checked. If specified, then each positional argument</span>
<span class="sd">            corresponds to an element of the tuple.  Tuples defined with traits</span>
<span class="sd">            are of fixed length.</span>
<span class="sd">        default_value : SequenceType [ optional ]</span>
<span class="sd">            The default value for the Tuple.  Must be list/tuple/set, and</span>
<span class="sd">            will be cast to a tuple. If ``traits`` are specified,</span>
<span class="sd">            ``default_value`` must conform to the shape and type they specify.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">default_value</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;default_value&#39;</span><span class="p">,</span> <span class="n">Undefined</span><span class="p">)</span>
        <span class="c1"># allow Tuple((values,)):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">traits</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">default_value</span> <span class="ow">is</span> <span class="n">Undefined</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_trait</span><span class="p">(</span><span class="n">traits</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">default_value</span> <span class="o">=</span> <span class="n">traits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">traits</span> <span class="o">=</span> <span class="p">()</span>

        <span class="k">if</span> <span class="n">default_value</span> <span class="ow">is</span> <span class="n">Undefined</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">default_value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_defaults</span><span class="p">):</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">default_value</span><span class="p">,)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;default value of </span><span class="si">%s</span><span class="s1"> was </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">default_value</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_traits</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">trait</span> <span class="ow">in</span> <span class="n">traits</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trait</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
                <span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Traits should be given as instances, not types (for example, `Int()`, not `Int`)&quot;</span>
                     <span class="s2">&quot; Passing types is deprecated in traitlets 4.1.&quot;</span><span class="p">,</span>
                     <span class="ne">DeprecationWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">trait</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trait</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span> <span class="k">else</span> <span class="n">trait</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_traits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_traits</span> <span class="ow">and</span> <span class="n">default_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># don&#39;t allow default to be an empty container if length is specified</span>
            <span class="n">args</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Container</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">klass</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">klass</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">validate_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_traits</span><span class="p">:</span>
            <span class="c1"># nothing to validate</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_traits</span><span class="p">):</span>
            <span class="n">e</span> <span class="o">=</span> <span class="s2">&quot;The &#39;</span><span class="si">%s</span><span class="s2">&#39; trait of </span><span class="si">%s</span><span class="s2"> instance requires </span><span class="si">%i</span><span class="s2"> elements, but a value of </span><span class="si">%s</span><span class="s2"> was specified.&quot;</span> \
                <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">class_of</span><span class="p">(</span><span class="n">obj</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_traits</span><span class="p">),</span> <span class="n">repr_type</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">TraitError</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

        <span class="n">validated</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_traits</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">_validate</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">TraitError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">validated</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">validated</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">class_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">trait</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_traits</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trait</span><span class="p">,</span> <span class="n">TraitType</span><span class="p">):</span>
                <span class="n">trait</span><span class="o">.</span><span class="n">class_init</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Container</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">class_init</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">instance_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">trait</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_traits</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trait</span><span class="p">,</span> <span class="n">TraitType</span><span class="p">):</span>
                <span class="n">trait</span><span class="o">.</span><span class="n">instance_init</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Container</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">instance_init</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Dict</span><span class="p">(</span><span class="n">Instance</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An instance of a Python dict.</span>

<span class="sd">    One or more traits can be passed to the constructor</span>
<span class="sd">    to validate the keys and/or values of the dict.</span>
<span class="sd">    If you need more detailed validation,</span>
<span class="sd">    you may use a custom validator method.</span>

<span class="sd">    .. versionchanged:: 5.0</span>
<span class="sd">        Added key_trait for validating dict keys.</span>

<span class="sd">    .. versionchanged:: 5.0</span>
<span class="sd">        Deprecated ambiguous ``trait``, ``traits`` args in favor of ``value_trait``, ``per_key_traits``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_value_trait</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_key_trait</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value_trait</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">per_key_traits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">key_trait</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a dict trait type from a Python dict.</span>

<span class="sd">        The default value is created by doing ``dict(default_value)``,</span>
<span class="sd">        which creates a copy of the ``default_value``.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value_trait : TraitType [ optional ]</span>
<span class="sd">            The specified trait type to check and use to restrict the values of</span>
<span class="sd">            the dict. If unspecified, values are not checked.</span>
<span class="sd">        per_key_traits : Dictionary of {keys:trait types} [ optional, keyword-only ]</span>
<span class="sd">            A Python dictionary containing the types that are valid for</span>
<span class="sd">            restricting the values of the dict on a per-key basis.</span>
<span class="sd">            Each value in this dict should be a Trait for validating</span>
<span class="sd">        key_trait : TraitType [ optional, keyword-only ]</span>
<span class="sd">            The type for restricting the keys of the dict. If</span>
<span class="sd">            unspecified, the types of the keys are not checked.</span>
<span class="sd">        default_value : SequenceType [ optional, keyword-only ]</span>
<span class="sd">            The default value for the Dict.  Must be dict, tuple, or None, and</span>
<span class="sd">            will be cast to a dict if not None. If any key or value traits are specified,</span>
<span class="sd">            the `default_value` must conform to the constraints.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; d = Dict(Unicode())</span>
<span class="sd">        a dict whose values must be text</span>

<span class="sd">        &gt;&gt;&gt; d2 = Dict(per_key_traits={&quot;n&quot;: Integer(), &quot;s&quot;: Unicode()})</span>
<span class="sd">        d2[&#39;n&#39;] must be an integer</span>
<span class="sd">        d2[&#39;s&#39;] must be text</span>

<span class="sd">        &gt;&gt;&gt; d3 = Dict(value_trait=Integer(), key_trait=Unicode())</span>
<span class="sd">        d3&#39;s keys must be text</span>
<span class="sd">        d3&#39;s values must be integers</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># handle deprecated keywords</span>
        <span class="n">trait</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;trait&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trait</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value_trait</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Found a value for both `value_trait` and its deprecated alias `trait`.&quot;</span><span class="p">)</span>
            <span class="n">value_trait</span> <span class="o">=</span> <span class="n">trait</span>
            <span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;Keyword `trait` is deprecated in traitlets 5.0, use `value_trait` instead&quot;</span><span class="p">,</span>
                <span class="ne">DeprecationWarning</span><span class="p">,</span>
                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">traits</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;traits&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">traits</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">per_key_traits</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Found a value for both `per_key_traits` and its deprecated alias `traits`.&quot;</span><span class="p">)</span>
            <span class="n">per_key_traits</span> <span class="o">=</span> <span class="n">traits</span>
            <span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;Keyword `traits` is deprecated in traitlets 5.0, use `per_key_traits` instead&quot;</span><span class="p">,</span>
                <span class="ne">DeprecationWarning</span><span class="p">,</span>
                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Handling positional arguments</span>
        <span class="k">if</span> <span class="n">default_value</span> <span class="ow">is</span> <span class="n">Undefined</span> <span class="ow">and</span> <span class="n">value_trait</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_trait</span><span class="p">(</span><span class="n">value_trait</span><span class="p">):</span>
                <span class="n">default_value</span> <span class="o">=</span> <span class="n">value_trait</span>
                <span class="n">value_trait</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">key_trait</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">per_key_traits</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">is_trait</span><span class="p">(</span><span class="n">per_key_traits</span><span class="p">):</span>
                <span class="n">key_trait</span> <span class="o">=</span> <span class="n">per_key_traits</span>
                <span class="n">per_key_traits</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Handling default value</span>
        <span class="k">if</span> <span class="n">default_value</span> <span class="ow">is</span> <span class="n">Undefined</span><span class="p">:</span>
            <span class="n">default_value</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">default_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">default_value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">default_value</span><span class="p">,)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">default_value</span><span class="p">,</span> <span class="n">SequenceTypes</span><span class="p">):</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">default_value</span><span class="p">,)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;default value of Dict was </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">default_value</span><span class="p">)</span>

        <span class="c1"># Case where a type of TraitType is provided rather than an instance</span>
        <span class="k">if</span> <span class="n">is_trait</span><span class="p">(</span><span class="n">value_trait</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value_trait</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
                <span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Traits should be given as instances, not types (for example, `Int()`, not `Int`)&quot;</span>
                     <span class="s2">&quot; Passing types is deprecated in traitlets 4.1.&quot;</span><span class="p">,</span>
                     <span class="ne">DeprecationWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">value_trait</span> <span class="o">=</span> <span class="n">value_trait</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_value_trait</span> <span class="o">=</span> <span class="n">value_trait</span>
        <span class="k">elif</span> <span class="n">value_trait</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;`value_trait` must be a Trait or None, got </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">repr_type</span><span class="p">(</span><span class="n">value_trait</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">is_trait</span><span class="p">(</span><span class="n">key_trait</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key_trait</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
                <span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Traits should be given as instances, not types (for example, `Int()`, not `Int`)&quot;</span>
                     <span class="s2">&quot; Passing types is deprecated in traitlets 4.1.&quot;</span><span class="p">,</span>
                     <span class="ne">DeprecationWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">key_trait</span> <span class="o">=</span> <span class="n">key_trait</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_key_trait</span> <span class="o">=</span> <span class="n">key_trait</span>
        <span class="k">elif</span> <span class="n">key_trait</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;`key_trait` must be a Trait or None, got </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">repr_type</span><span class="p">(</span><span class="n">key_trait</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_per_key_traits</span> <span class="o">=</span> <span class="n">per_key_traits</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">Dict</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">klass</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">element_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">validator</span><span class="p">,</span> <span class="n">side</span><span class="o">=</span><span class="s1">&#39;Values&#39;</span><span class="p">):</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">side</span> <span class="o">+</span> <span class="s2">&quot; of the &#39;</span><span class="si">%s</span><span class="s2">&#39; trait of </span><span class="si">%s</span><span class="s2"> instance must be </span><span class="si">%s</span><span class="s2">, but a value of </span><span class="si">%s</span><span class="s2"> was specified.&quot;</span> \
            <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">class_of</span><span class="p">(</span><span class="n">obj</span><span class="p">),</span> <span class="n">validator</span><span class="o">.</span><span class="n">info</span><span class="p">(),</span> <span class="n">repr_type</span><span class="p">(</span><span class="n">element</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">TraitError</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Dict</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_elements</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">validate_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">per_key_override</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_per_key_traits</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="n">key_trait</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_key_trait</span>
        <span class="n">value_trait</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value_trait</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">key_trait</span> <span class="ow">or</span> <span class="n">value_trait</span> <span class="ow">or</span> <span class="n">per_key_override</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">value</span>

        <span class="n">validated</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">key_trait</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="n">key_trait</span><span class="o">.</span><span class="n">_validate</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">TraitError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">element_error</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">key_trait</span><span class="p">,</span> <span class="s1">&#39;Keys&#39;</span><span class="p">)</span>
            <span class="n">active_value_trait</span> <span class="o">=</span> <span class="n">per_key_override</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value_trait</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">active_value_trait</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="n">active_value_trait</span><span class="o">.</span><span class="n">_validate</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">TraitError</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">element_error</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">active_value_trait</span><span class="p">,</span> <span class="s1">&#39;Values&#39;</span><span class="p">)</span>
            <span class="n">validated</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">klass</span><span class="p">(</span><span class="n">validated</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">class_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value_trait</span><span class="p">,</span> <span class="n">TraitType</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_value_trait</span><span class="o">.</span><span class="n">class_init</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_key_trait</span><span class="p">,</span> <span class="n">TraitType</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_key_trait</span><span class="o">.</span><span class="n">class_init</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_per_key_traits</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">trait</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_per_key_traits</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">trait</span><span class="o">.</span><span class="n">class_init</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Dict</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">class_init</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">instance_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value_trait</span><span class="p">,</span> <span class="n">TraitType</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_value_trait</span><span class="o">.</span><span class="n">instance_init</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_key_trait</span><span class="p">,</span> <span class="n">TraitType</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_key_trait</span><span class="o">.</span><span class="n">instance_init</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_per_key_traits</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">trait</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_per_key_traits</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">trait</span><span class="o">.</span><span class="n">instance_init</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Dict</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">instance_init</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">from_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load value from a single string&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;from_string expects a string, got </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="si">}</span><span class="s2"> of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_string_list</span><span class="p">([</span><span class="n">s</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">test</span> <span class="o">=</span> <span class="n">_safe_literal_eval</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">test</span>
            <span class="k">raise</span>

    <span class="k">def</span> <span class="nf">from_string_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a dict from a list of config strings.</span>

<span class="sd">        This is where we parse CLI configuration.</span>

<span class="sd">        Each item should have the form ``&quot;key=value&quot;``.</span>

<span class="sd">        item parsing is done in :meth:`.item_from_string`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">s_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;None&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_none</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">s_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
            <span class="ow">and</span> <span class="n">s_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;{&quot;</span><span class="p">)</span>
            <span class="ow">and</span> <span class="n">s_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;}&quot;</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;--</span><span class="si">{0}</span><span class="s2">=</span><span class="si">{1}</span><span class="s2"> for dict-traits is deprecated in traitlets 5.0. &quot;</span>
                <span class="s2">&quot;You can pass --</span><span class="si">{0}</span><span class="s2"> &lt;key=value&gt; ... multiple times to add items to a dict.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="n">s_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="p">),</span>
                <span class="ne">FutureWarning</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">return</span> <span class="n">literal_eval</span><span class="p">(</span><span class="n">s_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">combined</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">item_from_string</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">s_list</span><span class="p">]:</span>
            <span class="n">combined</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">combined</span>

    <span class="k">def</span> <span class="nf">item_from_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Cast a single-key dict from a string.</span>

<span class="sd">        Evaluated when parsing CLI configuration from a string.</span>

<span class="sd">        Dicts expect strings of the form key=value.</span>

<span class="sd">        Returns a one-key dictionary,</span>
<span class="sd">        which will be merged in :meth:`.from_string_list`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="s1">&#39;=&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">TraitError</span><span class="p">(</span>
                <span class="s2">&quot;&#39;</span><span class="si">%s</span><span class="s2">&#39; options must have the form &#39;key=value&#39;, got </span><span class="si">%s</span><span class="s2">&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">s</span><span class="p">),)</span>
            <span class="p">)</span>
        <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># cast key with key trait, if defined</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_key_trait</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_key_trait</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="c1"># cast value with value trait, if defined (per-key or global)</span>
        <span class="n">value_trait</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_per_key_traits</span> <span class="ow">or</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value_trait</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value_trait</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">value_trait</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">value</span><span class="p">}</span>


<span class="k">class</span> <span class="nc">TCPAddress</span><span class="p">(</span><span class="n">TraitType</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A trait for an (ip, port) tuple.</span>

<span class="sd">    This allows for both IPv4 IP addresses as well as hostnames.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">default_value</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">info_text</span> <span class="o">=</span> <span class="s1">&#39;an (ip, port) tuple&#39;</span>

    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
                    <span class="n">port</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">port</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">port</span> <span class="o">&lt;=</span> <span class="mi">65535</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">from_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_none</span> <span class="ow">and</span> <span class="n">s</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s1">&#39;:&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Require `ip:port`, got </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">s</span><span class="p">)</span>
        <span class="n">ip</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">CRegExp</span><span class="p">(</span><span class="n">TraitType</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A casting compiled regular expression trait.</span>

<span class="sd">    Accepts both strings and compiled regular expressions. The resulting</span>
<span class="sd">    attribute will be a compiled regular expression.&quot;&quot;&quot;</span>

    <span class="n">info_text</span> <span class="o">=</span> <span class="s1">&#39;a regular expression&#39;</span>

    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">UseEnum</span><span class="p">(</span><span class="n">TraitType</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Use a Enum class as model for the data type description.</span>
<span class="sd">    Note that if no default-value is provided, the first enum-value is used</span>
<span class="sd">    as default-value.</span>

<span class="sd">    .. sourcecode:: python</span>

<span class="sd">        # -- SINCE: Python 3.4 (or install backport: pip install enum34)</span>
<span class="sd">        import enum</span>
<span class="sd">        from traitlets import HasTraits, UseEnum</span>

<span class="sd">        class Color(enum.Enum):</span>
<span class="sd">            red = 1         # -- IMPLICIT: default_value</span>
<span class="sd">            blue = 2</span>
<span class="sd">            green = 3</span>

<span class="sd">        class MyEntity(HasTraits):</span>
<span class="sd">            color = UseEnum(Color, default_value=Color.blue)</span>

<span class="sd">        entity = MyEntity(color=Color.red)</span>
<span class="sd">        entity.color = Color.green    # USE: Enum-value (preferred)</span>
<span class="sd">        entity.color = &quot;green&quot;        # USE: name (as string)</span>
<span class="sd">        entity.color = &quot;Color.green&quot;  # USE: scoped-name (as string)</span>
<span class="sd">        entity.color = 3              # USE: number (as int)</span>
<span class="sd">        assert entity.color is Color.green</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">default_value</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">info_text</span> <span class="o">=</span> <span class="s2">&quot;Trait type adapter to a Enum class&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enum_class</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">enum_class</span><span class="p">,</span> <span class="n">enum</span><span class="o">.</span><span class="n">Enum</span><span class="p">),</span> \
                          <span class="s2">&quot;REQUIRE: enum.Enum, but was: </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">enum_class</span>
        <span class="n">allow_none</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;allow_none&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">default_value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">allow_none</span><span class="p">:</span>
            <span class="n">default_value</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">enum_class</span><span class="o">.</span><span class="n">__members__</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">UseEnum</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">default_value</span><span class="o">=</span><span class="n">default_value</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enum_class</span> <span class="o">=</span> <span class="n">enum_class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_prefix</span> <span class="o">=</span> <span class="n">enum_class</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span>

    <span class="k">def</span> <span class="nf">select_by_number</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">Undefined</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Selects enum-value by using its number-constant.&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
        <span class="n">enum_members</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">enum_class</span><span class="o">.</span><span class="n">__members__</span>
        <span class="k">for</span> <span class="n">enum_item</span> <span class="ow">in</span> <span class="n">enum_members</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">enum_item</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">value</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">enum_item</span>
        <span class="c1"># -- NOT FOUND:</span>
        <span class="k">return</span> <span class="n">default</span>

    <span class="k">def</span> <span class="nf">select_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">Undefined</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Selects enum-value by using its name or scoped-name.&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name_prefix</span><span class="p">):</span>
            <span class="c1"># -- SUPPORT SCOPED-NAMES, like: &quot;Color.red&quot; =&gt; &quot;red&quot;</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name_prefix</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">enum_class</span><span class="o">.</span><span class="n">__members__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">enum_class</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="c1"># -- CONVERT: number =&gt; enum_value (item)</span>
            <span class="n">value2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_by_number</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Undefined</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">value2</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="c1"># -- CONVERT: name or scoped_name (as string) =&gt; enum_value (item)</span>
            <span class="n">value2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_by_name</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Undefined</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">value2</span>
        <span class="k">elif</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_none</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_choices_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">as_rst</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns a description of the trait choices (not none).&quot;&quot;&quot;</span>
        <span class="n">choices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">enum_class</span><span class="o">.</span><span class="n">__members__</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">as_rst</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;|&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;``</span><span class="si">%r</span><span class="s1">``&#39;</span> <span class="o">%</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">choices</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">choices</span><span class="p">))</span>  <span class="c1"># Listify because py3.4- prints odict-class</span>

    <span class="k">def</span> <span class="nf">_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">as_rst</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns a description of the trait.&quot;&quot;&quot;</span>
        <span class="n">none</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39; or </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;`None`&#39;</span> <span class="k">if</span> <span class="n">as_rst</span> <span class="k">else</span> <span class="s1">&#39;None&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_none</span> <span class="k">else</span>
                <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39;any of </span><span class="si">%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_choices_str</span><span class="p">(</span><span class="n">as_rst</span><span class="p">),</span> <span class="n">none</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">(</span><span class="n">as_rst</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">info_rst</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">(</span><span class="n">as_rst</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>



<span class="k">class</span> <span class="nc">Callable</span><span class="p">(</span><span class="n">TraitType</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A trait which is callable.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Classes are callable, as are instances</span>
<span class="sd">    with a __call__() method.&quot;&quot;&quot;</span>

    <span class="n">info_text</span> <span class="o">=</span> <span class="s1">&#39;a callable&#39;</span>

    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_add_all</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;add all trait types to `__all__`</span>

<span class="sd">    do in a function to avoid iterating through globals while defining local variables</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">_name</span><span class="p">,</span> <span class="n">_value</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_value</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">_value</span><span class="p">,</span> <span class="n">TraitType</span><span class="p">):</span>
            <span class="n">__all__</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_name</span><span class="p">)</span>

<span class="n">_add_all</span><span class="p">()</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Cognitum Services S.A.

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>